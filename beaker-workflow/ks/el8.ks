<ks><![CDATA[
rootpw --iscrypted $1$bPnySNFo$QCqmVA1sHhddG7v.ivCbA0

%post
# Some distros have curl in their minimal install set, others have wget.
# We define a wrapper function around the best available implementation
# so that the rest of the script can use that for making HTTP requests.
if command -v curl >/dev/null ; then
    function fetch() {
        curl -kL --retry 5 -o "$1" "$2"
    }
elif command -v wget >/dev/null ; then
    function fetch() {
        wget --tries 5 --no-check-certificate -O "$1" "$2"
    }
else
    echo "No HTTP client command available!"
    function fetch() {
        false
    }
fi
##install certificate
fetch /etc/pki/ca-trust/source/anchors/RH-IT-Root-CA.crt https://password.corp.redhat.com/RH-IT-Root-CA.crt
fetch /etc/pki/ca-trust/source/anchors/legacy.crt  https://password.corp.redhat.com/legacy.crt
fetch /etc/pki/ca-trust/source/anchors/Eng-CA.crt https://engineering.redhat.com/Eng-CA.crt
update-ca-trust enable
update-ca-trust extract

##
fetch /var/tmp/gluster.cfg http://fileshare.englab.nay.redhat.com/pub/section2/kvm/networkstorage/gluster.cfg
fetch /var/tmp/iscsi.cfg http://fileshare.englab.nay.redhat.com/pub/section2/kvm/networkstorage/iscsi.cfg
fetch /var/tmp/ceph.cfg http://fileshare.englab.nay.redhat.com/pub/section2/kvm/networkstorage/ceph.cfg
fetch /var/tmp/ceph_config_on_client.sh http://fileshare.englab.nay.redhat.com/pub/section2/kvm/networkstorage/ceph_config_on_client.sh
chmod a+rx /var/tmp/ceph_config_on_client.sh
bash /var/tmp/ceph_config_on_client.sh
##

## disable sslverify
echo 'sslverify=0' >> /etc/dnf/dnf.conf

## Generate 'setup_bridge.sh'
base64 -d <<EOF > /root/setup_bridge.sh
IyEvYmluL2Jhc2gKCl9zZXR1cF9icmlkZ2UoKQp7CiAgICAjR2V0IHRoZSBFdGhlcm5ldCBpbnRl
cmZhY2UKICAgIE5ERVZfQVJSQVk9KCQoaXAgcm91dGUgbGlzdCBkZWZhdWx0IHwgZ3JlcCAtUG8g
Jyg/PD1kZXYgKShcUyspJyB8IGF3ayAne3ByaW50ICQxfScpKQogICAgZWNobyAiRGV2IHdpdGgg
ZGVmYXVsdCByb3V0ZSBpcy9hcmU6ICR7TkRFVl9BUlJBWVtAXX0iCiAgICBmb3IgKCggaWR4PTEg
OyBpZHggPCAkeyNOREVWX0FSUkFZW0BdfSA7IGlkeCsrICkpOyBkbwogICAgICAgIENPTlVVSURf
REVMPSQobm1jbGkgLWcgR0VORVJBTC5DT04tVVVJRCBkZXZpY2Ugc2hvdyAke05ERVZfQVJSQVlb
aWR4XX0pCiAgICAgICAgZWNobyAiRGVsZXRlIGNvbm5lY3Rpb24gJENPTlVVSURfREVMIgogICAg
ICAgIG5tY2xpIGNvbiBkZWxldGUgJENPTlVVSURfREVMCiAgICBkb25lCiAgICBOREVWPSR7TkRF
Vl9BUlJBWVswXX0KCiAgICAjR2V0IHRoZSBFdGhlcm5ldCBtYWMgYWRkcmVzcwogICAgTUFDX0FE
RFI9JChubWNsaSAtZyBHRU5FUkFMLkhXQUREUiBkZXZpY2Ugc2hvdyAke05ERVZ9IHwgc2VkIC1l
ICdzL1xcLy9nJykKCiAgICAjR2V0IGNvbm5lY3Rpb24gVVVJRAogICAgQ09OVVVJRD0kKG5tY2xp
IC1nIEdFTkVSQUwuQ09OLVVVSUQgZGV2aWNlIHNob3cgJHtOREVWfSkKICAgIGVjaG8gIlNldHVw
IEJyaWRnZSB3aXRoIGNvbm5lY3Rpb246ICRDT05VVUlEIgoKICAgIG5tY2xpIGNvbiBhZGQgdHlw
ZSBicmlkZ2UgaWZuYW1lICIkQlJJREdFX0lGTkFNRSIgY29uLW5hbWUgIiRCUklER0VfSUZOQU1F
IiBzdHAgbm8gODAyLTMtZXRoZXJuZXQuY2xvbmVkLW1hYy1hZGRyZXNzICIke01BQ19BRERSfSIK
ICAgIG5tY2xpIGNvbiBtb2RpZnkgIiRDT05VVUlEIiBtYXN0ZXIgIiRCUklER0VfSUZOQU1FIgog
ICAgbm1jbGkgY29uIHVwICIkQ09OVVVJRCIKICAgIFsgJD8gLW5lIDAgXSAmJiBlY2hvICJOZXR3
b3JrTWFuYWdlciBDb21tYW5kIGZhaWxlZCIgJiYgZXhpdCAxCn0KCl9jaGtfYnJpZGdlX2Rldl9p
cCgpCnsKICAgICMjIENoZWNrIHdoZXRoZXIgYnJpZGdlIGRldmljZSBnZXRzIGlwIGFkZHJlc3MK
ICAgIFNUQVJUPWBkYXRlICslc2AKICAgIHdoaWxlIFsgJCgoICQoZGF0ZSArJXMpIC0gMTIwICkp
IC1sdCAkU1RBUlQgXTsgZG8KICAgICAgICBJUF9BRERSPSQoaXAgYWRkcmVzcyBzaG93ICIkQlJJ
REdFX0lGTkFNRSIgfCBncmVwICJpbmV0XGIiIHwgYXdrICd7cHJpbnQgJDJ9JyB8IGN1dCAtZC8g
LWYxKQogICAgICAgIFtbIC1uICIkSVBfQUREUiIgXV0gJiYgZWNobyAiaXAgYWRkcmVzcyBvZiBi
cmlkZ2UgZGV2aWNlICckQlJJREdFX0lGTkFNRSc6ICRJUF9BRERSIiAmJiBleGl0IDAKICAgICAg
ICBzbGVlcCA1CiAgICBkb25lCiAgICBlY2hvICJGYWlsIHRvIGdldCBpcCBhZGRyZXNzIG9mIGJy
aWRnZSBkZXZpY2UgJyRCUklER0VfSUZOQU1FJyBpbiAyIG1pbnMiCiAgICBleGl0IDEKfQoKQlJJ
REdFX0lGTkFNRT0nc3dpdGNoJwoKX3NldHVwX2JyaWRnZQpfY2hrX2JyaWRnZV9kZXZfaXAK
EOF
chmod a+rx /root/setup_bridge.sh

## Adding qemu-ifup/down scripts to help manually debugging
base64 -d <<EOF > /etc/qemu-ifup
IyEvYmluL3NoCnN3aXRjaD1zd2l0Y2gKL3Vzci9zYmluL2lwIGxpbmsgc2V0ICQxIHVwCi91c3Iv
c2Jpbi9pcCBsaW5rIHNldCBkZXYgJDEgbWFzdGVyICR7c3dpdGNofQovdXNyL3NiaW4vaXAgbGlu
ayBzZXQgJHtzd2l0Y2h9IHR5cGUgYnJpZGdlIGZvcndhcmRfZGVsYXkgMAovdXNyL3NiaW4vaXAg
bGluayBzZXQgJHtzd2l0Y2h9IHR5cGUgYnJpZGdlIHN0cF9zdGF0ZSAwCg==
EOF

base64 -d <<EOF > /etc/qemu-ifdown
IyEvYmluL3NoCnN3aXRjaD1zd2l0Y2gKL3Vzci9zYmluL2lwIGxpbmsgc2V0ICQxIGRvd24KL3Vz
ci9zYmluL2lwIGxpbmsgc2V0IGRldiAkMSBub21hc3Rlcgo=
EOF
chmod a+rx /etc/qemu-if*
## End adding qemu-ifup/down scripts

## Install brewkoji
fetch /etc/yum.repos.d/rcm-tools-rhel-8.repo http://download.eng.bos.redhat.com/rel-eng/internal/rcm-tools-rhel-8-baseos.repo
dnf install brewkoji -y
## End brewkoji installation

## Generate 'component_management.py'
base64 -d <<EOF > /root/component_management.py
aW1wb3J0IGFyZ3BhcnNlCmltcG9ydCBqc29uCmltcG9ydCBvcwppbXBvcnQgcGxhdGZvcm0KaW1w
b3J0IHJlCmltcG9ydCByZXF1ZXN0cwppbXBvcnQgc2h1dGlsCmltcG9ydCBzdWJwcm9jZXNzCmlt
cG9ydCBzeXMKCgojIEdsb2JhbCB2YXJpYWJsZXMKUk9PVF9ESVIgPSBvcy5wYXRoLmFic3BhdGgo
b3MucGF0aC5kaXJuYW1lKF9fZmlsZV9fKSkKUVVJRVQgPSBGYWxzZQpET1dOR1JBREUgPSBGYWxz
ZQpMT0dfTFZMID0gMQpQS0dfTUdNVF9CSU4gPSAieXVtIgpCUkVXX1VSTCA9ICJodHRwOi8vZG93
bmxvYWQuZGV2ZWwucmVkaGF0LmNvbSIKTUJTX1VSTCA9ICJodHRwczovL21icy5lbmdpbmVlcmlu
Zy5yZWRoYXQuY29tL21vZHVsZS1idWlsZC1zZXJ2aWNlLzEvbW9kdWxlLWJ1aWxkcyIKUFlUSE9O
X01PRFVMRV9MSVNUID0gInB5dGhvbjItcHl5YW1sIgoKZGVmIGdldF9yZWxlYXNlX3ZlcnNpb24o
KToKICAgIGdsb2JhbCByZWxlYXNlX3ZlcnNpb24KCiAgICBkZXRlY3RfZmlsZSA9ICcvZXRjL29z
LXJlbGVhc2UnCiAgICB3aXRoIG9wZW4oZGV0ZWN0X2ZpbGUpIGFzIGZkOgogICAgICAgIGNvbnRl
bnQgPSBmZC5yZWFkKCkKICAgIG1hdGNoID0gcmUuc2VhcmNoKCdWRVJTSU9OX0lEPVwiKFxkK1wu
XGQrKVwiJywgY29udGVudCkKICAgIGlmIG1hdGNoOgogICAgICAgIHJlbGVhc2VfdmVyc2lvbiA9
IG1hdGNoLmdyb3VwKDEpCiAgICBlbHNlOgogICAgICAgX2xvZ19lcnJvcigiRmFpbGVkIHRvIGdl
dCB0aGUgc3lzdGVtIHZlcnNpb24iKQogICAgICAgX2V4aXQoMSkKCiMgQSBjb2xsZWN0aW9uIG9m
IFB5dGhvbiB1dGlsaXRpZXMgZnVuY3Rpb25zCmRlZiBfbG9nKGx2bCwgbXNnKToKICAgICIiIlBy
aW50IGEgbWVzc2FnZSB3aXRoIGxldmVsICdsdmwnIHRvIENvbnNvbGUiIiIKICAgIGlmIG5vdCBR
VUlFVCBhbmQgbHZsIDw9IExPR19MVkw6CiAgICAgICAgcHJpbnQobXNnKQoKZGVmIF9sb2dfZGVi
dWcobXNnKToKICAgICIiIlByaW50IGEgbWVzc2FnZSB3aXRoIGxldmVsIERFQlVHIHRvIENvbnNv
bGUiIiIKICAgIG1zZyA9ICJcMDMzWzk2bURFQlVHOiAiICsgbXNnICsgIlwwMzNbMDBtIgogICAg
X2xvZyg0LCBtc2cpCgpkZWYgX2xvZ19pbmZvKG1zZyk6CiAgICAiIiJQcmludCBhIG1lc3NhZ2Ug
d2l0aCBsZXZlbCBJTkZPIHRvIENvbnNvbGUiIiIKICAgIG1zZyA9ICJcMDMzWzkybUlORk86ICIg
KyBtc2cgKyAiXDAzM1swMG0iCiAgICBfbG9nKDMsIG1zZykKCmRlZiBfbG9nX3dhcm4obXNnKToK
ICAgICIiIlByaW50IGEgbWVzc2FnZSB3aXRoIGxldmVsIFdBUk4gdG8gQ29uc29sZSIiIgogICAg
bXNnID0gIlwwMzNbOTNtV0FSTjogIiArIG1zZyArICJcMDMzWzAwbSIKICAgIF9sb2coMiwgbXNn
KQoKZGVmIF9sb2dfZXJyb3IobXNnKToKICAgICIiIlByaW50IGEgbWVzc2FnZSB3aXRoIGxldmVs
IEVSUk9SIHRvIENvbnNvbGUiIiIKICAgIG1zZyA9ICJcMDMzWzkxbUVSUk9SOiAiICsgbXNnICsg
IlwwMzNbMDBtIgogICAgX2xvZygxLCBtc2cpCgpkZWYgX3N5c3RlbV9zdGF0dXNfb3V0cHV0KGNt
ZCk6CiAgICAiIiJSdW4gYSBzdWJwcm9jZXNzLCByZXR1cm5pbmcgaXRzIGV4aXQgY29kZSBhbmQg
b3V0cHV0LiIiIgogICAgc3AgPSBzdWJwcm9jZXNzLlBvcGVuKGNtZCwgc3Rkb3V0PXN1YnByb2Nl
c3MuUElQRSwKICAgICAgICAgICAgICAgICAgICAgICAgICBzdGRlcnI9c3VicHJvY2Vzcy5QSVBF
LCBzaGVsbD1UcnVlKQogICAgc3Rkb3V0LCBzdGRlcnIgPSBzcC5jb21tdW5pY2F0ZSgpCiAgICAj
IyBXYWl0IGZvciBjb21tYW5kIHRvIHRlcm1pbmF0ZS4gR2V0IHJldHVybiByZXR1cm5jb2RlICMj
CiAgICBzdGF0dXMgPSBzcC53YWl0KCkKICAgIHJldHVybiAoc3RhdHVzLCBzdGRvdXQuZGVjb2Rl
KCksIHN0ZGVyci5kZWNvZGUoKSkKCmRlZiBfc3lzdGVtKGNtZCk6CiAgICAiIiJSdW4gYSBzdWJw
cm9jZXNzLCByZXR1cm5pbmcgaXRzIGV4aXQgY29kZS4iIiIKICAgIHJldHVybiBfc3lzdGVtX3N0
YXR1c19vdXRwdXQoY21kKVswXQoKZGVmIF9zeXN0ZW1fb3V0cHV0KGNtZCk6CiAgICAiIiJSdW4g
YSBzdWJwcm9jZXNzLCByZXR1cm5pbmcgaXRzIG91dHB1dC4iIiIKICAgIHJldHVybiBfc3lzdGVt
X3N0YXR1c19vdXRwdXQoY21kKVsxXQoKZGVmIF9ydW5fY21kKGNtZCk6CiAgICAiIiIKICAgIFJ1
biBhIHN1YnByb2Nlc3MsIHJldHVybmluZyBpdHMgZXhpdCBjb2RlIGFuZCBwcmludCBzdGRvdXQv
c3RkZXJyCiAgICB0byBDb25zb2xlLgogICAgIiIiCiAgICBpZiBRVUlFVCBvciBMT0dfTFZMIDw9
IDE6CiAgICAgICAgcmV0dXJuIF9zeXN0ZW1fc3RhdHVzX291dHB1dChjbWQpWzBdCiAgICBlbHNl
OgogICAgICAgIG1zZyA9ICJcMDMzWzFtPT4gJXNcMDMzWzBtIiAlIGNtZAogICAgICAgIF9sb2co
TE9HX0xWTCwgbXNnKQogICAgICAgIHNwID0gc3VicHJvY2Vzcy5Qb3BlbihjbWQsIHNoZWxsPVRy
dWUpCiAgICAgICAgcmV0dXJuIHNwLndhaXQoKQoKZGVmIF9leGl0KHJldCk6CiAgICAiIiJFeGl0
IGZyb20gcHl0aG9uIGFjY29yZGluZyB0byB0aGUgZ2l2aW5nIGV4aXQgY29kZSIiIgogICAgaWYg
cmV0ICE9IDA6CiAgICAgICAgX2xvZyhMT0dfTFZMLCAiUGxlYXNlIGhhbmRsZSB0aGUgRVJST1Io
cykgYW5kIHJlLXJ1biB0aGlzIHNjcmlwdCIpCiAgICBzeXMuZXhpdChyZXQpCgpkZWYgX2V4aXRf
b25fZXJyb3IocmV0LCBtc2cpOgogICAgIiIiUHJpbnQgdGhlIGVycm9yIG1lc3NhZ2UgYW5kIGV4
aXQgZnJvbSBweXRob24gd2hlbiBsYXN0IGNvbW1hbmQgZmFpbHMiIiIKICAgIGlmIHJldCAhPSAw
OgogICAgICAgIF9sb2dfZXJyb3IobXNnKQogICAgICAgIF9leGl0KDEpCgpkZWYgX3dhcm5fb25f
ZXJyb3IocmV0LCBtc2cpOgogICAgIiIiUHJpbnQgdGhlIHdhcm4gbWVzc2FnZSB3aGVuIGxhc3Qg
Y29tbWFuZCBmYWlscyIiIgogICAgaWYgcmV0ICE9IDA6CiAgICAgICAgX2xvZ193YXJuKG1zZykK
CmRlZiBfaGFzX2NtZChjbWQpOgogICAgIiIiQ2hlY2sgd2hldGhlciBhIHByb2dyYW0gaXMgaW5z
dGFsbGVkIiIiCiAgICByZXR1cm4gX3N5c3RlbSgiY29tbWFuZCAtdiAlcyIgJSBjbWQpID09IDAK
CmRlZiBfaGFzX3JwbShwa2cpOgogICAgIiIiQ2hlY2sgd2hldGhlciBhIHBhY2thZ2UgaXMgaW5z
dGFsbGVkIiIiCiAgICByZXR1cm4gX3N5c3RlbSgicnBtIC1xICVzIiAlIHBrZykKCmRlZiBfaGFz
X21vZF9zcGVjKG1vZF9zcGVjKToKICAgICIiIkNoZWNrIHdoZXRoZXIgYSBtb2R1bGUgb3IgbW9k
dWxlIHN0cmVhbSBjb3VsZCBiZSB1c2VkIiIiCiAgICByZXR1cm4gX3N5c3RlbSgiJXMgbW9kdWxl
IGluZm8gJXMiICUgKFBLR19NR01UX0JJTiwgbW9kX3NwZWMpKQoKZGVmIF9jaGtfbW9kX2VuYWJs
ZWQobW9kX3NwZWMpOgogICAgIiIiQ2hlY2sgd2hldGhlciBhIG1vZHVsZSBvciBtb2R1bGUgc3Ry
ZWFtIGlzIGVuYWJsZWQiIiIKICAgIHJldHVybiBfc3lzdGVtKCIlcyBtb2R1bGUgbGlzdCAtLWVu
YWJsZWQgJXMiICUgKFBLR19NR01UX0JJTiwgbW9kX3NwZWMpKQoKZGVmIF9jaGtfbW9kX2Rpc2Fi
bGVkKG1vZF9zcGVjKToKICAgICIiIkNoZWNrIHdoZXRoZXIgYSBtb2R1bGUgb3IgbW9kdWxlIHN0
cmVhbSBpcyBkaXNhYmxlZCIiIgogICAgcmV0dXJuIF9zeXN0ZW0oIiVzIG1vZHVsZSBsaXN0IC0t
ZGlzYWJsZWQgJXMiICUgKFBLR19NR01UX0JJTiwgbW9kX3NwZWMpKQoKZGVmIF9jaGtfbW9kX2lu
c3RhbGxlZChtb2Rfc3BlYyk6CiAgICAiIiJDaGVjayB3aGV0aGVyIGEgbW9kdWxlIG9yIG1vZHVs
ZSBzdHJlYW0gaXMgaW5zdGFsbGVkIiIiCiAgICByZXR1cm4gX3N5c3RlbSgiJXMgbW9kdWxlIGxp
c3QgLS1pbnN0YWxsZWQgJXMiICUgKFBLR19NR01UX0JJTiwgbW9kX3NwZWMpKQoKZGVmIF9jcmVh
dGVfbW9kdWxlX3JlcG8obW9kX2lkKToKICAgICIiIkRvd25sb2FkIGFsbCB0aGUgcGFja2FnZXMg
Zm9yIGEgbW9kdWxlLCBhbmQgY3JlYXRlIGEgcmVwbyBmb3IgaXQiIiIKICAgIGlmIF9oYXNfcnBt
KCJjcmVhdGVyZXBvX2MiKSAhPSAwOgogICAgICAgIF9sb2dfaW5mbygiSW5zdGFsbCBwYWNrYWdl
ICdjcmVhdGVyZXBvX2MnIikKICAgICAgICAocmV0LCBvdXQsIGVycm9yKSA9IF9zeXN0ZW1fc3Rh
dHVzX291dHB1dCgiZG5mIGluc3RhbGwgY3JlYXRlcmVwbyAteSIpCiAgICAgICAgX2V4aXRfb25f
ZXJyb3IocmV0LCAiRmFpbGVkIHRvIGluc3RhbGwgJ2NyZWF0ZXJlcG8nLCBvdXRwdXQ6ICVzIiAl
IG91dCkKICAgIGlmIF9oYXNfcnBtKCJtaW5pLXRwcyIpICE9IDA6CiAgICAgICAgX2xvZ19pbmZv
KCJJbnN0YWxsIHBhY2thZ2UgJ21pbmktdHBzJyIpCiAgICAgICAgKHJldCwgb3V0LCBlcnJvcikg
PSBfc3lzdGVtX3N0YXR1c19vdXRwdXQoImN1cmwgLWtMICIgXAogICAgICAgICAgICAiaHR0cHM6
Ly9jb3ByLmRldmVsLnJlZGhhdC5jb20vY29wcnMvYXN0ZXBhbm8vbWluaS10cHMvcmVwby9yaGVs
LTguZGV2L21pbmktdHBzLnJlcG8gIiBcCiAgICAgICAgICAgICItbyAvZXRjL3l1bS5yZXBvcy5k
L21pbmktdHBzLnJlcG8gJiYgIiBcCiAgICAgICAgICAgICJzZWQgLWkgcy9cJGJhc2VhcmNoL3g4
Nl82NC8gL2V0Yy95dW0ucmVwb3MuZC9taW5pLXRwcy5yZXBvICYmIiBcCiAgICAgICAgICAgICJk
bmYgaW5zdGFsbCAteSBtaW5pLXRwcyIpCiAgICAgICAgX2V4aXRfb25fZXJyb3IocmV0LCAiRmFp
bGVkIHRvIGluc3RhbGwgJ21pbmktdHBzJywgb3V0cHV0OiAlcyIgJSBvdXQpCgogICAgX2xvZ19p
bmZvKCJDcmVhdGUgbW9kdWxlIHJlcG8gZm9yIG1vZHVsZTogJXMiICUgbW9kX2lkKQogICAgKHJl
dCwgb3V0LCBlcnJvcikgPSBfc3lzdGVtX3N0YXR1c19vdXRwdXQoIm10cHMtZ2V0LW1vZHVsZSAt
LXZlcmJvc2UgLS1jcmVhdGVyZXBvIiBcCiAgICAgICAgIiAtLWluc3RhbGxyZXBvZmlsZSAtLW1i
c2lkPSVzIC0tZG93bmxvYWQ9L3Zhci9saWIvbW9kdWxlLXJlcG9kYXRhLSVzIiAlIChtb2RfaWQs
IG1vZF9pZCkpCiAgICBpZiBub3Qgb3MucGF0aC5leGlzdHMoIi92YXIvbGliL21vZHVsZS1yZXBv
ZGF0YS0lcyIgJW1vZF9pZCk6CiAgICAgICAgX2xvZ19lcnJvcigiRmFpbGVkIHRvIGNyZWF0ZSBy
ZXBvIGZvciBtb2R1bGUgJXMgd2l0aCBtdHBzLWdldC1tb2R1bGUsIG91dHB1dDpcbiVzIiAlKG1v
ZF9pZCwgb3V0KSkKICAgICAgICBfbG9nX2luZm8oIlRyeSBpbnN0YWxsIHBhY2thZ2VzIGZyb20g
YnJld3dlYiBpbnN0ZWFkIG9mIG1vZHVsZSByZXBvIikKICAgICAgICByZXR1cm4gRmFsc2UKICAg
IF9sb2dfaW5mbygiQ3JlYXRlIG1vZHVsZSByZXBvIGZvciBtb2R1bGU6ICVzIHN1Y2Nlc3MiICUg
bW9kX2lkKQogICAgbW9kdWxlX3JlcG8gPSAnL2V0Yy95dW0ucmVwb3MuZC92aXJ0X21vZHVsZV8l
cy5yZXBvJyAlIG1vZF9pZAogICAgX2xvZ19pbmZvKCJTZXQgaGlnaGVzdCBwcmlvcml0eSBmb3Ig
dGhlIG1vZHVsZSByZXBvICVzIiAlIG1vZHVsZV9yZXBvKQogICAgX3N5c3RlbSgnbXYgL2V0Yy95
dW0ucmVwb3MuZC9icmV3Ki5yZXBvICVzICYmIGVjaG8gInByaW9yaXR5ID0gMSIgPj4gJXMnICUg
KG1vZHVsZV9yZXBvLCBtb2R1bGVfcmVwbykpCiAgICByZXR1cm4gVHJ1ZQoKZGVmIF9wYXJzZV9i
cmV3X3BrZyhicmV3X3BrZyk6CiAgICAiIiIKICAgIFBhcnNlIHRoZSBhcmd1bWVudCB0byBnZXQg
aW5mb3JtYXRpb24gb2YgYnJldyBwYWNrYWdlLgogICAgOiByZXR1cm4gYnVpbGQ6ICBCdWlsZCBu
YW1lIGV4cGVjdGVkIHRvIGJlIGluc3RhbGxlZAogICAgOiByZXR1cm4gcGtnczogICBSUE1zIGxp
c3QgaW5jbHVkZWQgaW4gdGhlIGJ1aWxkIHdoaWNoIGFyZSBleHBlY3RlZCB0byBiZQogICAgICAg
ICAgICAgICAgICAgICBpbnN0YWxsZWQuIElmIE5vbmUsIGFsbCB0aGUgUlBNcyBpbmNsdWRlZCBp
biB0aGUgYnVpbGQKICAgICAgICAgICAgICAgICAgICAgd2lsbCBiZSBpbnN0YWxsZWQKICAgIDog
cmV0dXJuIGFyY2hlczogQXJjaGl0ZWN0dXJlIHNwZWNpZmllZCBSUE1zIHdpbGwgYmUgaW5zdGFs
bGVkLiBJZiBOb25lLAogICAgICAgICAgICAgICAgICAgICB0aGUgZGVmYXVsdCB2YWx1ZSBhcmUg
dGhlIGhvc3QgbWFjaGluZSB0eXBlIGFuZCBub2FyY2gKICAgICIiIgogICAgYnVpbGQgPSBicmV3
X3BrZy5zcGxpdCgnLycpWzBdCiAgICB0YWcgPSAnJwogICAgcGtncyA9ICcnCiAgICBhcmNoZXMg
PSBwbGF0Zm9ybS5tYWNoaW5lKCkKICAgIGlmIGJ1aWxkLmZpbmQoIkAiKSA+PSAwOgogICAgICAg
IHRhZyA9IGJ1aWxkLnNwbGl0KCdAJylbMV0KICAgICAgICBidWlsZCA9IGJ1aWxkLnNwbGl0KCdA
JylbMF0KICAgICAgICBjbWQgPSAiYnJldyBsYXRlc3QtYnVpbGQgJXMgJXMgLS1xdWlldCAyPiYx
IiAlICh0YWcsIGJ1aWxkKQogICAgICAgIChyZXQsIG91dCwgXykgPSBfc3lzdGVtX3N0YXR1c19v
dXRwdXQoY21kKQogICAgICAgIF9leGl0X29uX2Vycm9yKHJldCwgIkZhaWxlZCB0byBnZXQgdGhl
IGxhdGVzdCBidWlsZCBvZiAnJXMgKCVzKScsIgogICAgICAgICAgICAgICAgICAgICAgICIgY29t
bWFuZCBvdXRwdXQ6XG4lcyIgJSAoYnVpbGQsIHRhZywgb3V0KSkKICAgICAgICBidWlsZCA9IG91
dC5zcGxpdCgpWzBdCiAgICBpZiBicmV3X3BrZy5jb3VudCgiLyIpID49IDE6CiAgICAgICAgcGtn
cyA9IGJyZXdfcGtnLnNwbGl0KCcvJylbMV0KICAgIGlmIGJyZXdfcGtnLmNvdW50KCIvIikgPT0g
MjoKICAgICAgICBhcmNoZXMgPSBicmV3X3BrZy5zcGxpdCgnLycpWzJdCiAgICBhcmNoZXMgKz0g
Iixub2FyY2giCiAgICByZXR1cm4gKGJ1aWxkLCBwa2dzLCBhcmNoZXMpCgpkZWYgX2dldF9ycG1f
bGlzdChidWlsZCwgYXJjaGVzKToKICAgICIiIgogICAgR2V0IFJQTXMgbGlzdCBhY2NvcmRpbmcg
dG8gYnVpbGQgbmFtZSBhbmQgc3BlY2lmaWVkIGFyY2hpdGVjaHR1cmVzLgogICAgIiIiCiAgICBy
cG1fbGlzdCA9IFtdCiAgICAocmV0LCBvdXQsIF8pID0gX3N5c3RlbV9zdGF0dXNfb3V0cHV0KCJi
cmV3IGJ1aWxkaW5mbyAlcyAyPiYxIiAlIGJ1aWxkKQogICAgX2V4aXRfb25fZXJyb3IocmV0LCAi
RmFpbGVkIHRvIGdldCBidWlsZCBpbmZvbWF0aW9uIG9mICclcycsIGNvbW1hbmQiCiAgICAgICAg
ICAgICAgICAgICAiIG91dHB1dDpcbiVzIiAlIChidWlsZCwgb3V0KSkKICAgIHJwbXMgPSByZS5z
ZWFyY2gociJSUE1zXHMqOlxzKiguKlwucnBtKSIsIG91dCwgcmUuUykuZ3JvdXAoMSkKICAgIGZv
ciBycG0gaW4gcnBtcy5zcGxpdGxpbmVzKCk6CiAgICAgICAgcnBtID0gcnBtLnNwbGl0KClbMF0K
ICAgICAgICBpZiAicWVtdS1rdm0tdGVzdHMiIGluIHJwbToKICAgICAgICAgICAgY29udGludWUK
ICAgICAgICBmb3IgYXJjaCBpbiBhcmNoZXMuc3BsaXQoJywnKToKICAgICAgICAgICAgaWYgcnBt
LmZpbmQoIiVzLnJwbSIgJSBhcmNoKSA+PSAwOgogICAgICAgICAgICAgICAgcnBtX2xpc3QuYXBw
ZW5kKHJwbS5yZXBsYWNlKCIvbW50L3JlZGhhdCIsIEJSRVdfVVJMKSkKICAgIHJldHVybiBycG1f
bGlzdAoKZGVmIF9nZXRfcmVxdWlyZWRfcnBtX2xpc3QocnBtX2xpc3QsIHBrZ3MpOgogICAgIiIi
CiAgICBHZXQgcmVxdWlyZWQgUlBNcyBmcm9tIHRoZSBSUE1zIGxpc3QuIElmIG5vIHNwZWNpZmlj
IFJQTXMgYXJlIHNwZWNpZmllZCwKICAgIGFsbCB0aGUgUlBNcyBpbiB0aGUgbGlzdCB3aWxsIGJl
IGV4cGVjdGVkIHRvIGJlIGluc3RhbGxlZC4KICAgICIiIgogICAgcmVxX3JwbV9saXN0ID0gW10K
ICAgIGlmIG5vdCBwa2dzOgogICAgICAgIHJldHVybiBycG1fbGlzdAogICAgZm9yIHBrZyBpbiBw
a2dzLnNwbGl0KCcsJyk6CiAgICAgICAgaGFzX3BrZyA9IEZhbHNlCiAgICAgICAgZm9yIHJwbSBp
biBycG1fbGlzdDoKICAgICAgICAgICAgaWYgcnBtLmZpbmQoJy8nKSA+PSAwOgogICAgICAgICAg
ICAgICAgcGtnX25hbWUgPSBycG0ucnNwbGl0KCcvJywgMSlbMV0ucnNwbGl0KCctJywgMilbMF0K
ICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHBrZ19uYW1lID0gcnBtLnJzcGxpdCgn
LScsIDIpWzBdCiAgICAgICAgICAgIGlmIHBrZ19uYW1lID09IHBrZzoKICAgICAgICAgICAgICAg
IGhhc19wa2cgPSBUcnVlCiAgICAgICAgICAgICAgICByZXFfcnBtX2xpc3QuYXBwZW5kKHJwbSkK
ICAgICAgICBpZiBub3QgaGFzX3BrZzoKICAgICAgICAgICAgX2xvZ19pbmZvKCInJXMnIGlzIG5v
dCBpbiAnJXMnLCBza2lwcGVkIiAlIChwa2csIHJwbV9saXN0KSkKICAgIHJldHVybiByZXFfcnBt
X2xpc3QgaWYgcmVxX3JwbV9saXN0IGVsc2UgcnBtX2xpc3QKCmRlZiBfZ2V0X21vZF9pbmZvX2Zy
b21fbWJzKG1vZF9pZCk6CiAgICAiIiIKICAgIEdldCBtb2R1bGUgaW5mb3JtYXRpb24gYWNjb3Jk
aW5nIHRvIHRoZSBtb2R1bGUgaWQgZnJvbSBNQlMuCiAgICAiIiIKICAgIG1vZF9pbmZvID0ge30K
ICAgIHVybCA9IE1CU19VUkwgKyAnLycgKyBtb2RfaWQKICAgIHJlc3BvbnNlID0ganNvbi5sb2Fk
cyhyZXF1ZXN0cy5nZXQodXJsKS50ZXh0KQogICAgbW9kX2luZm9bJ3N0YXRlX25hbWUnXSA9IHJl
c3BvbnNlLmdldCgic3RhdGVfbmFtZSIpCiAgICBtb2RfaW5mb1snc2NtdXJsJ10gPSByZXNwb25z
ZS5nZXQoInNjbXVybCIpCiAgICBtb2RfaW5mb1sna29qaV90YWcnXSA9IHJlc3BvbnNlLmdldCgi
a29qaV90YWciKQogICAgbW9kX2luZm9bJ3JwbXMnXSA9IHJlc3BvbnNlLmdldCgidGFza3MiKS5n
ZXQoInJwbXMiKQogICAgbW9kX2luZm9bJ3N0cmVhbSddID0gcmVzcG9uc2UuZ2V0KCJzdHJlYW0i
KQogICAgbW9kX2luZm9bJ3BsYXRmb3JtX3N0cmVhbSddID0gcmVzcG9uc2UuZ2V0KCJidWlsZHJl
cXVpcmVzIikuZ2V0KCJwbGF0Zm9ybSIpLmdldCgnc3RyZWFtJykKICAgIHJldHVybiBtb2RfaW5m
bwoKZGVmIF9jaGVja19tb2R1bGVfaXNfcmVhZHkobW9kX2lkKToKICAgICIiIgogICAgQ2hlY2sg
d2hldGhlciB0aGUgbW9kdWxlIHN0YXRlIGlzIHJlYWR5LiBXaGVuIHRoZSBzdGF0ZSBpcyBGYWls
ZWQsIG1vZHVsZQogICAgc2hvdWxkIG5vdCBiZSB1c2VkIGZvciB0ZXN0aW5nLgogICAgIiIiCiAg
ICBtb2RfaW5mbyA9IF9nZXRfbW9kX2luZm9fZnJvbV9tYnMobW9kX2lkKQogICAgaWYgbW9kX2lu
Zm8uZ2V0KCdzdGF0ZV9uYW1lJykgPT0gInJlYWR5IjoKICAgICAgICByZXR1cm4gVHJ1ZQogICAg
cmV0dXJuIEZhbHNlCgpkZWYgX2dldF9tb2RfaWRfZnJvbV9rb2ppX3RhZyhrb2ppX3RhZyk6CiAg
ICAiIiIKICAgIFVzZSB0aGUga29qaSB0YWcgdG8gZ2V0IGFsbCB0aGUgY29tcG9uZW50cyBpbmNs
dWRlZCBpbiB0aGUgbW9kdWxlLCBhbmQgdGhlbgogICAgY29tcGFyZSB0aGUgbW9kdWxlIGlkIGlu
IGVhY2ggY29tcG9uZW50LiBUaGUgbWF4aW11bSBtb2R1bGUgaWQgc2hvdWxkIGJlCiAgICB0aGUg
bGF0ZXN0IG9uZS4KICAgICIiIgogICAgbW9kX2lkID0gTm9uZQogICAgKHJldCwgY3BudF9saXN0
LCBfKSA9IF9zeXN0ZW1fc3RhdHVzX291dHB1dCgiYnJldyBsaXN0LXRhZ2dlZCAlcyAyPiYxIiAl
CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBrb2ppX3Rh
ZykKICAgIF9leGl0X29uX2Vycm9yKHJldCwgIkZhaWxlZCB0byBnZXQgY29tcG9uZW5ldCBsaXN0
ICclcycsIGNvbW1hbmQiCiAgICAgICAgICAgICAgICAgICAiIG91dHB1dDpcbiVzIiAlIChrb2pp
X3RhZywgY3BudF9saXN0KSkKICAgIGZvciBjcG50IGluIGNwbnRfbGlzdC5zcGxpdGxpbmVzKCk6
CiAgICAgICAgc2VhcmNoX29iaiA9IHJlLnNlYXJjaChyIm1vZHVsZVwrZWxbXitdK1wrKFxkKylc
KyIsIGNwbnQsIHJlLkkpCiAgICAgICAgaWYgbm90IHNlYXJjaF9vYmo6CiAgICAgICAgICAgIGNv
bnRpbnVlCiAgICAgICAgaWYgbm90IG1vZF9pZCBvciBpbnQobW9kX2lkKSA8IGludChzZWFyY2hf
b2JqLmdyb3VwKDEpKToKICAgICAgICAgICAgbW9kX2lkID0gc2VhcmNoX29iai5ncm91cCgxKQog
ICAgcmV0dXJuIG1vZF9pZAoKZGVmIF9kb3duZ3JhZGVfbW9kdWxlX3ZlcnNpb24obmFtZSwgc3Ry
ZWFtLCByZWxlYXNlKToKICAgICIiIgogICAgZG93bmdyYWRlIG1vZHVsZSB2ZXJzaW9uIHdoZW4g
dGhlcmUgaXMgbm8gYXZhaWxhYmxlIG1vZHVsZSBmb3IgY3VycmVudCByZWxlYXNlCiAgICAiIiIK
ICAgIGZpcnN0VmVyc2lvbiA9IHJlbGVhc2Uuc3BsaXQoJy4nKVswXQogICAgc2Vjb25kVmVyc2lv
biA9IGludChyZWxlYXNlLnNwbGl0KCcuJylbMV0pCiAgICB0aGlyZFZlcnNpb24gPSBpbnQocmVs
ZWFzZS5zcGxpdCgnLicpWzJdKQogICAgaWYgc3RyZWFtID09ICJyaGVsIjoKICAgICAgICBzZWNv
bmRWZXJzaW9uID0gc2Vjb25kVmVyc2lvbiAtIDEKICAgICAgICByZXR1cm4gIiVzOiVzOiVzLiVz
LiVzIiAlIChuYW1lLCBzdHJlYW0sIGZpcnN0VmVyc2lvbiwgc2Vjb25kVmVyc2lvbiwgdGhpcmRW
ZXJzaW9uKQogICAgaWYgdGhpcmRWZXJzaW9uID4gMDoKICAgICAgICB0aGlyZFZlcnNpb24gPSB0
aGlyZFZlcnNpb24gLTEKICAgIGVsc2U6CiAgICAgICAgc2Vjb25kVmVyc2lvbiA9IHNlY29uZFZl
cnNpb24gLTEKICAgICAgICBzdHJlYW0gPSAiJXMuJXMiICUgKGZpcnN0VmVyc2lvbiwgc2Vjb25k
VmVyc2lvbikKICAgIHJldHVybiAiJXM6JXM6JXMuJXMuJXMiICUgKG5hbWUsIHN0cmVhbSwgZmly
c3RWZXJzaW9uLCBzZWNvbmRWZXJzaW9uLCB0aGlyZFZlcnNpb24pCgpkZWYgX2dldF9tb2RfaWRf
ZnJvbV9tb2R1bGUobW9kX25hbWUpOgogICAgIiIiCiAgICBHZXQga29qaSB0YWcgZnJvbSBtb2R1
bGUgbmFtZSBhbmQgbW9kdWxlIHN0cmVhbSwgdGhlbiB1c2Uga29qaSB0YWcgdG8gZ2V0CiAgICB0
aGUgbW9kdWxlIGlkLgogICAgIiIiCiAgICBpZiBsZW4obW9kX25hbWUuc3BsaXQoJzonKSkgIT0g
MzoKICAgICAgICBfZXhpdF9vbl9lcnJvcigxLCAiSW52YWxpZCBtb2R1bGUgbmFtZTogJXMiICUg
bW9kX25hbWUpCiAgICBuYW1lID0gbW9kX25hbWUuc3BsaXQoJzonKVswXQogICAgc3RyZWFtID0g
bW9kX25hbWUuc3BsaXQoJzonKVsxXQogICAgdGFyZ2V0X3JlbGVhc2UgPSBtb2RfbmFtZS5zcGxp
dCgnOicpWzJdCiAgICBpZiBsZW4odGFyZ2V0X3JlbGVhc2Uuc3BsaXQoJy4nKSkgIT0gMzoKICAg
ICAgICBfZXhpdF9vbl9lcnJvcigxLCAiSW52YWxpZCB0YXJnZXQgcmVsZWFzZTogJXMiICUgdGFy
Z2V0X3JlbGVhc2UpCiAgICB2ZXJzaW9uID0gdGFyZ2V0X3JlbGVhc2Uuc3BsaXQoJy4nKVswXQog
ICAgZm9yIGkgaW4gcmFuZ2UoMSwzKToKICAgICAgICB2ID0gdGFyZ2V0X3JlbGVhc2Uuc3BsaXQo
Jy4nKVtpXQogICAgICAgIGlmIGxlbih2KSA9PSAyOgogICAgICAgICAgICB2ZXJzaW9uID0gdmVy
c2lvbiArIHYKICAgICAgICBlbGlmIGxlbih2KSA9PSAxOgogICAgICAgICAgICB2ZXJzaW9uID0g
dmVyc2lvbiArICcwJyArIHYKICAgICAgICBlbHNlOgogICAgICAgICAgICBfZXhpdF9vbl9lcnJv
cigxLCAiSW52YWxpZCB0YXJnZXQgcmVsZWFzZTogJXMiICUgdGFyZ2V0X3JlbGVhc2UpCiAgICBw
bGF0Zm9ybV90YWcgPSAibW9kdWxlLSVzLSVzLSVzIiAlIChuYW1lLCBzdHJlYW0sIHZlcnNpb24p
CiAgICBjbWQgPSAiYnJldyBsaXN0LXRhcmdldHMgfCBncmVwICVzIHwgc29ydCAtciAyPiYxIiAl
IHBsYXRmb3JtX3RhZwogICAgKHJldCwga29qaV90YWdfbGlzdCwgXykgPSBfc3lzdGVtX3N0YXR1
c19vdXRwdXQoY21kKQogICAgX2V4aXRfb25fZXJyb3IocmV0LCAiRmFpbGVkIHRvIGdldCBrb2pp
IHRhZyBvZiAnJXMnLCBjb21tYW5kIgogICAgICAgICAgICAgICAgICAgIiBvdXRwdXQ6XG4lcyIg
JSAocGxhdGZvcm1fdGFnLCBrb2ppX3RhZ19saXN0KSkKICAgIGZvciBrb2ppX3RhZyBpbiBrb2pp
X3RhZ19saXN0LnNwbGl0bGluZXMoKToKICAgICAgICBtb2RfaWQgPSBfZ2V0X21vZF9pZF9mcm9t
X2tvamlfdGFnKGtvamlfdGFnLnNwbGl0KClbMF0pCiAgICAgICAgaWYgX2NoZWNrX21vZHVsZV9p
c19yZWFkeShtb2RfaWQpOgogICAgICAgICAgICByZXR1cm4gbW9kX2lkCiAgICBpZiBET1dOR1JB
REU6CiAgICAgICAgbmV3X21vZF9uYW1lID0gX2Rvd25ncmFkZV9tb2R1bGVfdmVyc2lvbihuYW1l
LCBzdHJlYW0sIHRhcmdldF9yZWxlYXNlKQogICAgICAgIHJldHVybiBfZ2V0X21vZF9pZF9mcm9t
X21vZHVsZShuZXdfbW9kX25hbWUpCiAgICByZXR1cm4gTm9uZQoKZGVmIF9nZXRfbW9kX2lkX2Zy
b21fcGFja2FnZShwa2dfbmFtZSk6CiAgICAiIiIKICAgIEdldCBrb2ppIHRhZyBmcm9tIHBhY2th
Z2UgbmFtZS4gVGhlbiBnZXQgdGhlIG1vZHVsZSBpZCBmcm9tIGtvamkgdGFnLgogICAgTm90aWNl
IHRoYXQgbm90IGFsbCB0aGUgZ290dGVuIGtvamkgdGFncyBjb3VsZCBiZSB1c2VkLiBTb21lIG9m
IHRoZW0gbWF5CiAgICBiZSBiZWxvbmdlZCB0byBhIGFib3J0ZWQgbW9kdWxlLgogICAgIiIiCiAg
ICBpZiBwa2dfbmFtZS5zdGFydHN3aXRoKCJtb2R1bGUtdmlydCIpOgogICAgICAgIHRhZ3MgPSBw
a2dfbmFtZQogICAgZWxzZToKICAgICAgICAocmV0LCBvdXQsIF8pID0gX3N5c3RlbV9zdGF0dXNf
b3V0cHV0KCJicmV3IGJ1aWxkaW5mbyAlcyAyPiYxIiAlCiAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICBwa2dfbmFtZSkKICAgICAgICBfZXhpdF9vbl9lcnJvcihy
ZXQsICJGYWlsZWQgdG8gZ2V0IGJ1aWxkIGluZm9tYXRpb24gb2YgJyVzJywgY29tbWFuZCIKICAg
ICAgICAgICAgICAgICAgICAgICAiIG91dHB1dDpcbiVzIiAlIChwa2dfbmFtZSwgb3V0KSkKICAg
ICAgICB0YWdzID0gcmUuc2VhcmNoKHIiVGFnc1xzKjpccyooLiopIiwgb3V0LCByZS5JKS5ncm91
cCgxKQogICAgdGFnX2xpc3QgPSB0YWdzLnNwbGl0KCkKICAgIHRhZ19saXN0LnJldmVyc2UoKQog
ICAgZm9yIGtvamlfdGFnIGluIHRhZ19saXN0OgogICAgICAgIGlmIGtvamlfdGFnLmVuZHN3aXRo
KCItYnVpbGQiKToKICAgICAgICAgICAgY29udGludWUKICAgICAgICBtb2RfaWQgPSBfZ2V0X21v
ZF9pZF9mcm9tX2tvamlfdGFnKGtvamlfdGFnKQogICAgICAgIGlmIF9jaGVja19tb2R1bGVfaXNf
cmVhZHkobW9kX2lkKToKICAgICAgICAgICAgcmV0dXJuIG1vZF9pZAogICAgcmV0dXJuIE5vbmUK
CmRlZiBfZ2V0X21vZF9pZChtb2RfaWQpOgogICAgIiIiCiAgICBHZXQgbW9kdWxlIGlkCiAgICAi
IiIKICAgIGlmIG1vZF9pZC5pc2RpZ2l0KCk6CiAgICAgICAgcmV0dXJuIG1vZF9pZAogICAgaWYg
bW9kX2lkLnN0YXJ0c3dpdGgoJ3ZpcnQ6Jyk6CiAgICAgICAgcmV0dXJuIF9nZXRfbW9kX2lkX2Zy
b21fbW9kdWxlKG1vZF9pZCkKICAgIHJldHVybiBfZ2V0X21vZF9pZF9mcm9tX3BhY2thZ2UobW9k
X2lkKQoKZGVmIF9nZXRfcnBtX2xpc3RfZnJvbV92aXJ0X3lhbWwobW9kX2luZm8pOgogICAgIiIi
CiAgICBHZXQgUlBNcyBsaXN0IGZvciB2aXJ0IG1vZHVsZSBmcm9tIHRoZSB5YW1sIGNvbmZpZ3Vy
YXRpb24uCiAgICAiIiIKICAgIGltcG9ydCB5YW1sCiAgICByZXBvX2RpciA9IG9zLnBhdGguam9p
bihST09UX0RJUiwgInZpcnQiKQogICAgeWFtbF9jb25mID0gb3MucGF0aC5qb2luKHJlcG9fZGly
LCAidmlydC55YW1sIikKICAgIHJlcG8gPSBtb2RfaW5mby5nZXQoInNjbXVybCIpLnNwbGl0KCc/
IycpWzBdCiAgICBjb21taXRfaGFzaCA9IG1vZF9pbmZvLmdldCgic2NtdXJsIikuc3BsaXQoJz8j
JylbMV0KICAgIGlmIG9zLnBhdGguZXhpc3RzKHJlcG9fZGlyKToKICAgICAgICBzaHV0aWwucm10
cmVlKHJlcG9fZGlyKQogICAgKHJldCwgXywgZXJyKSA9IF9zeXN0ZW1fc3RhdHVzX291dHB1dCgi
Z2l0IGNsb25lICVzICVzIiAlIChyZXBvLCByZXBvX2RpcikpCiAgICBfZXhpdF9vbl9lcnJvcihy
ZXQsICJGYWlsZWQgdG8gY2xvbmUgcmVwbyAnJXMnLCBFcnJvciBtZXNzYWdlOlxuJXMiICUKICAg
ICAgICAgICAgICAgICAgIChyZXBvLCBlcnIpKQogICAgX3N5c3RlbSgiZ2l0IC1DICVzIGNoZWNr
b3V0ICVzIiAlIChyZXBvX2RpciwgY29tbWl0X2hhc2gpKQogICAgdmlydF9pbmZvID0geWFtbC5s
b2FkKG9wZW4oeWFtbF9jb25mKSkKICAgIHJwbXNfaW5mbyA9IHZpcnRfaW5mby5nZXQoImRhdGEi
KS5nZXQoImNvbXBvbmVudHMiKS5nZXQoInJwbXMiKQogICAgcmV0dXJuIHJwbXNfaW5mbwoKZGVm
IF9nZXRfY3BudF9saXN0X2Zvcl9xZW11KG1vZF9pbmZvKToKICAgICIiIgogICAgR2V0IGNvbXBv
bmVudCBsaXN0IGZvciBxZW11IGFuZCBxZW11IGRlcGVuZGVuY2llcy4KICAgICIiIgogICAgY3Bu
dF9saXN0ID0gW10KICAgIHJwbXNfaW5mbyA9IF9nZXRfcnBtX2xpc3RfZnJvbV92aXJ0X3lhbWwo
bW9kX2luZm8pCiAgICBmb3IgcnBtIGluIHJwbXNfaW5mby5rZXlzKCk6CiAgICAgICAgaWYgcnBt
c19pbmZvLmdldChycG0pLmdldCgicmF0aW9uYWxlIikuZmluZCgicWVtdS1rdm0iKSA8IDA6CiAg
ICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgaWYgbm90IHJwbXNfaW5mby5nZXQocnBtKS5nZXQo
ImFyY2hlcyIpOgogICAgICAgICAgICBjcG50X2xpc3QuYXBwZW5kKHJwbSkKICAgICAgICAgICAg
Y29udGludWUKICAgICAgICBpZiBwbGF0Zm9ybS5tYWNoaW5lKCkgaW4gcnBtc19pbmZvLmdldChy
cG0pLmdldCgiYXJjaGVzIik6CiAgICAgICAgICAgIGNwbnRfbGlzdC5hcHBlbmQocnBtKQogICAg
Y3BudF9saXN0LmFwcGVuZCgncWVtdS1rdm0nKQogICAgcmV0dXJuIGNwbnRfbGlzdAoKZGVmIF9n
ZXRfY3BudF9saXN0X2Zvcl9saWJ0cG1zKG1vZF9pbmZvKToKICAgICIiIgogICAgR2V0IGNvbXBv
bmVudCBsaXN0IGZvciBsaWJ0cG1zIGFuZCBsaWJ0cG1zIGRlcGVuZGVuY2llcy4KICAgICIiIgog
ICAgY3BudF9saXN0ID0gW10KICAgIHJwbXNfaW5mbyA9IF9nZXRfcnBtX2xpc3RfZnJvbV92aXJ0
X3lhbWwobW9kX2luZm8pCiAgICBmb3IgcnBtIGluIHJwbXNfaW5mby5rZXlzKCk6CiAgICAgICAg
aWYgcnBtc19pbmZvLmdldChycG0pLmdldCgicmF0aW9uYWxlIikuZmluZCgibGlidHBtcyIpIDwg
MDoKICAgICAgICAgICAgY29udGludWUKICAgICAgICBpZiBub3QgcnBtc19pbmZvLmdldChycG0p
LmdldCgiYXJjaGVzIik6CiAgICAgICAgICAgIGNwbnRfbGlzdC5hcHBlbmQocnBtKQogICAgICAg
ICAgICBjb250aW51ZQogICAgICAgIGlmIHBsYXRmb3JtLm1hY2hpbmUoKSBpbiBycG1zX2luZm8u
Z2V0KHJwbSkuZ2V0KCJhcmNoZXMiKToKICAgICAgICAgICAgY3BudF9saXN0LmFwcGVuZChycG0p
CiAgICBjcG50X2xpc3QuYXBwZW5kKCdsaWJ0cG1zJykKICAgIHJldHVybiBjcG50X2xpc3QKCmRl
ZiBfZ2V0X2NwbnRfbGlzdF9mb3Jfc3d0cG0obW9kX2luZm8pOgogICAgIiIiCiAgICBHZXQgY29t
cG9uZW50IGxpc3QgZm9yIHN3dHBtIGFuZCBzd3RwbSBkZXBlbmRlbmNpZXMuCiAgICAiIiIKICAg
IGNwbnRfbGlzdCA9IFtdCiAgICBycG1zX2luZm8gPSBfZ2V0X3JwbV9saXN0X2Zyb21fdmlydF95
YW1sKG1vZF9pbmZvKQogICAgZm9yIHJwbSBpbiBycG1zX2luZm8ua2V5cygpOgogICAgICAgIGlm
IHJwbXNfaW5mby5nZXQocnBtKS5nZXQoInJhdGlvbmFsZSIpLmZpbmQoInN3dHBtIikgPCAwOgog
ICAgICAgICAgICBjb250aW51ZQogICAgICAgIGlmIG5vdCBycG1zX2luZm8uZ2V0KHJwbSkuZ2V0
KCJhcmNoZXMiKToKICAgICAgICAgICAgY3BudF9saXN0LmFwcGVuZChycG0pCiAgICAgICAgICAg
IGNvbnRpbnVlCiAgICAgICAgaWYgcGxhdGZvcm0ubWFjaGluZSgpIGluIHJwbXNfaW5mby5nZXQo
cnBtKS5nZXQoImFyY2hlcyIpOgogICAgICAgICAgICBjcG50X2xpc3QuYXBwZW5kKHJwbSkKICAg
IGNwbnRfbGlzdC5hcHBlbmQoJ3N3dHBtJykKICAgIHJldHVybiBjcG50X2xpc3QKCmRlZiBfZ2V0
X3BrZ19saXN0X2Zvcl9xZW11KG1vZF9pZCk6CiAgICAiIiIKICAgIEdldCBwYWNrYWdlIGxpc3Qg
Zm9yIHFlbXUgYW5kIHFlbXUgZGVwZW5kZW5jaWVzLCBhbmQgcGFja2FnZXMgYmUgdXNlZCBieQog
ICAgcWVtdS1rdm0ncyBmZWF0dXJlKGxpYnRwbXMsIHN3dHBtKQogICAgIiIiCiAgICBwa2dfbGlz
dCA9IFtdCiAgICBtb2RfaW5mbyA9IF9nZXRfbW9kX2luZm9fZnJvbV9tYnMobW9kX2lkKQogICAg
Y3BudF9saXN0ID0gX2dldF9jcG50X2xpc3RfZm9yX3FlbXUobW9kX2luZm8pCiAgICBjcG50X2xp
c3QgKz0gX2dldF9jcG50X2xpc3RfZm9yX2xpYnRwbXMobW9kX2luZm8pCiAgICBjcG50X2xpc3Qg
Kz0gX2dldF9jcG50X2xpc3RfZm9yX3N3dHBtKG1vZF9pbmZvKQogICAgZm9yIGNwbnQgaW4gY3Bu
dF9saXN0OgogICAgICAgIHBrZ19saXN0LmFwcGVuZChtb2RfaW5mby5nZXQoInJwbXMiKS5nZXQo
Y3BudCkuZ2V0KCJudnIiKSkKICAgIHJldHVybiBwa2dfbGlzdAoKZGVmIF9pbnN0YWxsX3BrZ19s
aXN0KHBrZ19saXN0KToKICAgICIiIgogICAgSW5zdGFsbCByZXF1aXJlZCBwYWNrYWdlcy4KICAg
ICIiIgogICAgKHJldCwgXywgZXJyKSA9IF9zeXN0ZW1fc3RhdHVzX291dHB1dCgiJXMgaW5zdGFs
bCAteSAlcyIgJQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoUEtH
X01HTVRfQklOLCBwa2dfbGlzdCkpCiAgICBfZXhpdF9vbl9lcnJvcihyZXQsICJJbnN0YWxsIHBh
Y2thZ2VzICclcycgZmFpbGVkLCBlcnJvciBtZXNzYWdlOiAlcyIgJQogICAgICAgICAgICAgICAg
ICAgKHBrZ19saXN0LCBlcnIpKQoKCiMgQSBjb2xsZWN0aW9uIG9mIFB5dGhvbiBiYXNpYyBmdW5j
dGlvbnMKZGVmIGVuYWJsZV9tb2QobW9kX3NwZWNfbGlzdCk6CiAgICAiIiIKICAgIEVuYWJsZSBh
bGwgdGhlIG1vZHVsZSBzdHJlYW1zIGluIHRoZSBtb2R1bGUgc3BlYyBsaXN0IGFuZCBtYWtlIHRo
ZSBzdHJlYW0KICAgIFJQTXMgYXZhaWxhYmxlIGluIHRoZSBwYWNrYWdlIHNldC4KICAgICIiIgog
ICAgaWYgbm90IG1vZF9zcGVjX2xpc3Q6CiAgICAgICAgcmV0dXJuCiAgICBmb3IgbW9kX3NwZWMg
aW4gbW9kX3NwZWNfbGlzdC5zcGxpdCgpOgogICAgICAgIF9leGl0X29uX2Vycm9yKF9oYXNfbW9k
X3NwZWMobW9kX3NwZWMpLAogICAgICAgICAgICAgICAgICAgICAgICJNb2R1bGUgJyVzJyBkb2Vz
bid0IGV4aXN0IiAlIG1vZF9zcGVjKQogICAgICAgIGlmIF9jaGtfbW9kX2VuYWJsZWQobW9kX3Nw
ZWMpID09IDA6CiAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgX2xvZ19pbmZvKCJFbmFibGUg
TW9kdWxlICVzIiAlIG1vZF9zcGVjKQogICAgICAgIChyZXQsIF8sIGVycikgPSBfc3lzdGVtX3N0
YXR1c19vdXRwdXQoIiVzIG1vZHVsZSBlbmFibGUgLXkgJXMiCiAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAlIChQS0dfTUdNVF9CSU4sIG1vZF9zcGVjKSkKICAg
ICAgICBpZiByZXQgIT0gMDoKICAgICAgICAgICAgX2V4aXRfb25fZXJyb3IoX2Noa19tb2RfZW5h
YmxlZChtb2Rfc3BlYyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICJNb2R1bGUgJyVzJyB3
YXNuJ3QgZW5hYmxlZCglcykiICUgKG1vZF9zcGVjLCBlcnIpKQoKZGVmIGRpc2FibGVfbW9kKG1v
ZF9zcGVjX2xpc3QpOgogICAgIiIiCiAgICBEaXNhYmxlIGFsbCB0aGUgbW9kdWxlIGluIHRoZSBt
b2R1bGUgc3BlYyBsaXN0LiBBbGwgcmVsYXRlZCBtb2R1bGUgc3RyZWFtcwogICAgd2lsbCBiZWNv
bWUgdW5hdmFpbGFibGUuCiAgICAiIiIKICAgIGlmIG5vdCBtb2Rfc3BlY19saXN0OgogICAgICAg
IHJldHVybgogICAgZm9yIG1vZF9zcGVjIGluIG1vZF9zcGVjX2xpc3Quc3BsaXQoKToKICAgICAg
ICBfZXhpdF9vbl9lcnJvcihfaGFzX21vZF9zcGVjKG1vZF9zcGVjKSwKICAgICAgICAgICAgICAg
ICAgICAgICAiTW9kdWxlICclcycgZG9lc24ndCBleGlzdCIgJSBtb2Rfc3BlYykKICAgICAgICBt
b2RfbmFtZSA9IG1vZF9zcGVjLnNwbGl0KCI6IilbMF0KICAgICAgICBpZiBfY2hrX21vZF9kaXNh
YmxlZChtb2RfbmFtZSkgPT0gMDoKICAgICAgICAgICAgY29udGludWUKICAgICAgICBfbG9nX2lu
Zm8oIkRpc2FibGUgTW9kdWxlICVzIiAlIG1vZF9uYW1lKQogICAgICAgIChyZXQsIF8sIGVycikg
PSBfc3lzdGVtX3N0YXR1c19vdXRwdXQoIiVzIG1vZHVsZSBkaXNhYmxlIC15ICVzIgogICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJSAoUEtHX01HTVRfQklOLCBt
b2RfbmFtZSkpCiAgICAgICAgaWYgcmV0ICE9MDoKICAgICAgICAgICAgX2V4aXRfb25fZXJyb3Io
X2Noa19tb2RfZGlzYWJsZWQobW9kX25hbWUpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAi
TW9kdWxlICclcycgd2Fzbid0IGRpc2FibGVkKCVzKSIgJQogICAgICAgICAgICAgICAgICAgICAg
ICAgICAobW9kX25hbWUsIGVycikpCgpkZWYgaW5zdGFsbF9tb2QobW9kX3NwZWNfbGlzdCk6CiAg
ICAiIiIKICAgIEluc3RhbGwgYWxsIHRoZSBtb2R1bGUgcHJvZmlsZXMgaW5jbC4gdGhlaXIgUlBN
cyBpbiB0aGUgbW9kdWxlIHNwZWMgbGlzdC4KICAgIEluIGNhc2Ugbm8gcHJvZmlsZSB3YXMgcHJv
dmlkZWQsIGFsbCBkZWZhdWx0IHByb2ZpbGVzIGdldCBpbnN0YWxsZWQuIE1vZHVsZQogICAgc3Ry
ZWFtcyBnZXQgZW5hYmxlZCBhY2NvcmRpbmdseS4KICAgICIiIgogICAgaWYgbm90IG1vZF9zcGVj
X2xpc3Q6CiAgICAgICAgcmV0dXJuCiAgICBmb3IgbW9kX3NwZWMgaW4gbW9kX3NwZWNfbGlzdC5z
cGxpdCgpOgogICAgICAgIF9leGl0X29uX2Vycm9yKF9oYXNfbW9kX3NwZWMobW9kX3NwZWMpLAog
ICAgICAgICAgICAgICAgICAgICAgICJNb2R1bGUgJyVzJyBkb2Vzbid0IGV4aXN0IiAlIG1vZF9z
cGVjKQogICAgICAgIGlmIF9jaGtfbW9kX2luc3RhbGxlZChtb2Rfc3BlYykgPT0gMDoKICAgICAg
ICAgICAgY29udGludWUKICAgICAgICBtb2RfbmFtZSA9IG1vZF9zcGVjLnNwbGl0KCI6IilbMF0K
ICAgICAgICBpZiBfY2hrX21vZF9pbnN0YWxsZWQobW9kX25hbWUpID09IDA6CiAgICAgICAgICAg
IF9zeXN0ZW0oIiVzIG1vZHVsZSByZW1vdmUgLXkgJXMiICUgKFBLR19NR01UX0JJTiwgbW9kX25h
bWUpKQogICAgICAgIF9sb2dfaW5mbygiSW5zdGFsbCBNb2R1bGUgJXMiICUgbW9kX3NwZWMpCiAg
ICAgICAgb3V0ID0gX3N5c3RlbV9vdXRwdXQoImRuZiBtb2R1bGUgaW5mbyAlcyIgJSBtb2Rfc3Bl
YykKICAgICAgICBzZWFyY2hfb2JqID0gcmUuc2VhcmNoKHIiRGVmYXVsdCBwcm9maWxlc1xzKzpc
cysoXFMrKVxuIiwgb3V0LCByZS5JKQogICAgICAgIGlmIG5vdCBzZWFyY2hfb2JqOgogICAgICAg
ICAgICBwcm9maWxlID0gcmUuc2VhcmNoKHIiUHJvZmlsZXNccys6XHMrKFxTKylcbiIsCiAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgb3V0LCByZS5JKS5ncm91cCgxKS5zcGxpdCgnLCcp
WzBdCiAgICAgICAgICAgIG1vZF9zcGVjID0gbW9kX3NwZWMgKyAnLycgKyBwcm9maWxlCiAgICAg
ICAgKHJldCwgXywgZXJyKSA9IF9zeXN0ZW1fc3RhdHVzX291dHB1dCgiJXMgbW9kdWxlIGluc3Rh
bGwgLXkgJXMiICUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IChQS0dfTUdNVF9CSU4sIG1vZF9zcGVjKSkKICAgICAgICBpZiByZXQgIT0gMDoKICAgICAgICAg
ICAgX2V4aXRfb25fZXJyb3IoX2Noa19tb2RfaW5zdGFsbGVkKG1vZF9zcGVjLnNwbGl0KCcvJylb
MF0pLAogICAgICAgICAgICAgICAgICAgICAgICAgICAiTW9kdWxlICclcycgd2Fzbid0IGluc3Rh
bGxlZCglcykiICUKICAgICAgICAgICAgICAgICAgICAgICAgICAgKG1vZF9zcGVjLCBlcnIpKQoK
ZGVmIGluc3RhbGxfcGtnX2Zyb21fcmVwbyhyZXBvX3BrZ19saXN0KToKICAgICIiIgogICAgSW5z
dGFsbCBhbGwgdGhlIHBhY2thZ2VzIGFuZCB0aGVpciBkZXBlbmRlbmNpZXMgaW4gdGhlIHBhY2th
Z2UgbGlzdAogICAgZnJvbSBhbnkgZW5hYmxlZCByZXBvc2l0b3J5LgogICAgIiIiCiAgICBpZiBu
b3QgcmVwb19wa2dfbGlzdDoKICAgICAgICByZXR1cm4KICAgIGZvciByZXBvX3BrZyBpbiByZXBv
X3BrZ19saXN0LnNwbGl0KCk6CiAgICAgICAgaWYgX2hhc19ycG0ocmVwb19wa2cpID09IDA6CiAg
ICAgICAgICAgIGlmIFBLR19NR01UX0JJTiA9PSAiZG5mIjoKICAgICAgICAgICAgICAgIChyZXQs
IF8sIGVycikgPSBfc3lzdGVtX3N0YXR1c19vdXRwdXQoIiVzIGRpc3Ryby1zeW5jIC15ICVzIiAl
CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChQ
S0dfTUdNVF9CSU4sIHJlcG9fcGtnKSkKICAgICAgICAgICAgICAgIF9leGl0X29uX2Vycm9yKHJl
dCwgIlBhY2thZ2UgJyVzJyB3YXNuJ3Qgc3luY2VkKCVzKSIgJQogICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgKHJlcG9fcGtnLCBlcnIpKQogICAgICAgICAgICBjb250aW51ZQogICAgICAg
IF9sb2dfaW5mbygiSW5zdGFsbCBwYWNrYWdlICVzIiAlIHJlcG9fcGtnKQogICAgICAgIChyZXQs
IF8sIGVycikgPSBfc3lzdGVtX3N0YXR1c19vdXRwdXQoIiVzIGluc3RhbGwgLXkgJXMiICUKICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChQS0dfTUdNVF9CSU4s
IHJlcG9fcGtnKSkKICAgICAgICBpZiByZXQgIT0gMDoKICAgICAgICAgICAgX2V4aXRfb25fZXJy
b3IoX2hhc19ycG0ocmVwb19wa2cpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAiUGFja2Fn
ZSAnJXMnIHdhc24ndCBpbnN0YWxsZWQoJXMpIiAlCiAgICAgICAgICAgICAgICAgICAgICAgICAg
IChyZXBvX3BrZywgZXJyKSkKCmRlZiBpbnN0YWxsX3BrZ19mcm9tX2JyZXcoYnJld19wa2dfbGlz
dCk6CiAgICAiIiIKICAgIEluc3RhbGwgYWxsIHRoZSBwYWNrYWdlcyBhbmQgdGhlaXIgZGVwZW5k
ZW5jaWVzIGluIHRoZSBwYWNrYWdlIGxpc3QKICAgIGZyb20gYnJldy4KICAgICIiIgogICAgaWYg
bm90IGJyZXdfcGtnX2xpc3Q6CiAgICAgICAgcmV0dXJuCiAgICBmb3IgYnJld19wa2cgaW4gYnJl
d19wa2dfbGlzdC5zcGxpdCgpOgogICAgICAgIChidWlsZCwgcGtncywgYXJjaGVzKSA9IF9wYXJz
ZV9icmV3X3BrZyhicmV3X3BrZykKICAgICAgICBycG1fbGlzdCA9IF9nZXRfcnBtX2xpc3QoYnVp
bGQsIGFyY2hlcykKICAgICAgICBpbnN0YWxsX3JwbV9saXN0ID0gX2dldF9yZXF1aXJlZF9ycG1f
bGlzdChycG1fbGlzdCwgcGtncykKICAgICAgICBfbG9nX2luZm8oIkluc3RhbGwgcGFja2FnZSAl
cyIgJSBidWlsZCkKICAgICAgICAocmV0LCBfLCBlcnIpID0gX3N5c3RlbV9zdGF0dXNfb3V0cHV0
KCIlcyBpbnN0YWxsIC15ICVzIiAlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAoUEtHX01HTVRfQklOLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICcgJy5qb2luKGluc3RhbGxfcnBtX2xpc3QpKSkKICAgICAgICBpZiBy
ZXQgIT0gMDoKICAgICAgICAgICAgX2V4aXRfb25fZXJyb3IoX2hhc19ycG0oYnVpbGQpLAogICAg
ICAgICAgICAgICAgICAgICAgICAgICAiUGFja2FnZSAnJXMnIHdhc24ndCBpbnN0YWxsZWQoJXMp
IiAlCiAgICAgICAgICAgICAgICAgICAgICAgICAgIChidWlsZCwgZXJyKSkKCmRlZiBpbnN0YWxs
X3ZpcnRfcWVtdV9mcm9tX2JyZXcobW9kX2lkKToKICAgICIiIgogICAgSW5zdGFsbCBxZW11IGFu
ZCBxZW11IGRlcGVuZGVuY2llcyBpbmNsdWRlZCBhIHZpcnQgbW9kdWxlLiBPdGhlciBwYWNrYWdl
cwogICAgbGlrZSBsaWJ2aXJ0IHdvdWxkbid0IGJlIGluc3RhbGxlZC4gVGhlIGFyZ3VtZW50IGNv
dWxkIG1vZHVsZSBpZCwgcWVtdQogICAgcGFja2FnZSwga29qaSB0YWcsIGFuZCBtb2R1bGUgbmFt
ZSB3aXRoIHN0cmVhbS4KICAgICIiIgogICAgaWYgbm90IG1vZF9pZDoKICAgICAgICByZXR1cm4K
ICAgIG1vZF9pZCA9IF9nZXRfbW9kX2lkKG1vZF9pZCkKICAgIGlmIG5vdCBtb2RfaWQ6CiAgICAg
ICAgX2V4aXRfb25fZXJyb3IoMSwgIkZhaWx0IHRvIGdldCBtb2R1bGUgaWQiKQogICAgX2xvZ19p
bmZvKCJNb2R1bGUgaWQgaXMgJXMiICUgbW9kX2lkKQogICAgaWYgX2NyZWF0ZV9tb2R1bGVfcmVw
byhtb2RfaWQpOgogICAgICAgIG1vZF9pbmZvID0gX2dldF9tb2RfaW5mb19mcm9tX21icyhtb2Rf
aWQpCiAgICAgICAgbW9kX3N0cmVhbSA9IG1vZF9pbmZvWyJzdHJlYW0iXQogICAgICAgIGRpc2Fi
bGVfbW9kKCJ2aXJ0IikKICAgICAgICBfc3lzdGVtKCJkbmYgY2xlYW4gYWxsIikKICAgICAgICBl
bmFibGVfbW9kKCJ2aXJ0OiVzIiAlbW9kX3N0cmVhbSkKICAgICAgICBpbnN0YWxsX21vZCgidmly
dDolcyIgJW1vZF9zdHJlYW0pCiAgICAgICAgaWYgbW9kX3N0cmVhbSAhPSAncmhlbCc6CiAgICAg
ICAgICAgIGV4dHJhX3BrZ19saXN0ID0gImxpYnRwbXMgc3d0cG0gc3d0cG0tdG9vbHMgc3d0cG0t
bGlicyIKICAgICAgICAgICAgaWYgbW9kX2luZm9bInBsYXRmb3JtX3N0cmVhbSJdID49ICdlbDgu
My4xJzoKICAgICAgICAgICAgICAgIGV4dHJhX3BrZ19saXN0ICs9ICIgcWVtdS1raXdpIgogICAg
ICAgICAgICBpbnN0YWxsX3BrZ19mcm9tX3JlcG8oZXh0cmFfcGtnX2xpc3QpCiAgICBlbHNlOgog
ICAgICAgIHBrZ19saXN0ID0gX2dldF9wa2dfbGlzdF9mb3JfcWVtdShtb2RfaWQpCiAgICAgICAg
ZGlzYWJsZV9tb2QoInZpcnQiKQogICAgICAgIGluc3RhbGxfcGtnX2Zyb21fYnJldygnICcuam9p
bihwa2dfbGlzdCkpCgpkZWYgcGFyc2Vfb3B0cygpOgogICAgIiIiCiAgICBQYXJzZSBhcmd1bWVu
dHMuCiAgICAiIiIKICAgIHBhcnNlciA9IGFyZ3BhcnNlLkFyZ3VtZW50UGFyc2VyKGZvcm1hdHRl
cl9jbGFzcz1hcmdwYXJzZS5SYXdUZXh0SGVscEZvcm1hdHRlcikKICAgIHBhcnNlci5hZGRfYXJn
dW1lbnQoCiAgICAgICAgJy0tZW5hYmxlLW1vZHVsZScsCiAgICAgICAgYWN0aW9uPSJzdG9yZSIs
CiAgICAgICAgaGVscD0nJycKICAgICAgICAgICAgIEVuYWJsZSBtb2R1bGUgc3RyZWFtcyBpbiB0
aGUgbW9kdWxlIGxpc3QgYW5kIG1ha2UgdGhlIHN0cmVhbSBSUE1zIGF2YWlsYWJsZSBpbiB0aGUg
cGFja2FnZSBzZXQuCiAgICAgICAgICAgICBTdXBwb3J0IHRvIGVuYWJsZSBtdWx0aXBsZSBtb2R1
bGVzIGF0IG9uY2UsIHdoaWNoIGFyZSBzZXBhcmF0ZWQgYnkgc3BhY2UuIEV4YW1wbGU6CiAgICAg
ICAgICAgICBFbmFibGUgc2xvdyB0cmFpbiB2aXJ0IG1vZHVsZTogLS1lbmFibGUtbW9kdWxlICd2
aXJ0OnJoZWwnCiAgICAgICAgICAgICBFbmFibGUgZmFzdCB0cmFpbiB2aXJ0IG1vZHVsZTogLS1l
bmFibGUtbW9kdWxlICd2aXJ0OjguMCcKICAgICAgICAgICAgICcnJwogICAgKQogICAgcGFyc2Vy
LmFkZF9hcmd1bWVudCgKICAgICAgICAnLS1kaXNhYmxlLW1vZHVsZScsCiAgICAgICAgYWN0aW9u
PSJzdG9yZSIsCiAgICAgICAgaGVscD0nJycKICAgICAgICAgICAgIERpc2FibGUgYSBtb2R1bGUu
IEFsbCByZWxhdGVkIG1vZHVsZSBzdHJlYW1zIHdpbGwgYmVjb21lIHVuYXZhaWxhYmxlLiBTdXBw
b3J0IHRvIGRpc2FibGUgbXVsdGlwbGUKICAgICAgICAgICAgIG1vZHVsZXMgYXQgb25jZSwgd2hp
Y2ggYXJlIHNlcGFyYXRlZCBieSBzcGFjZS4gRXhhbXBsZToKICAgICAgICAgICAgIERpc2FibGUg
dmlydCBtb2R1bGU6IC0tZGlzYWJsZS1tb2R1bGUgJ3ZpcnQnIG9yIC0tZGlzYWJsZS1tb2R1bGUg
J3ZpcnQ6cmhlbCcKICAgICAgICAgICAgICcnJwogICAgKQogICAgcGFyc2VyLmFkZF9hcmd1bWVu
dCgKICAgICAgICAnLS1pbnN0YWxsLW1vZHVsZScsCiAgICAgICAgYWN0aW9uPSJzdG9yZSIsCiAg
ICAgICAgaGVscD0nJycKICAgICAgICAgICAgIEluc3RhbGwgbW9kdWxlIHByb2ZpbGVzIGluY2wu
IHRoZWlyIFJQTXMuIEluIGNhc2Ugbm8gcHJvZmlsZSB3YXMgcHJvdmlkZWQsIGFsbCBkZWZhdWx0
IHByb2ZpbGVzIGdldAogICAgICAgICAgICAgaW5zdGFsbGVkLiBNb2R1bGUgc3RyZWFtcyBnZXQg
ZW5hYmxlZCBhY2NvcmRpbmdseS4gU3VwcG9ydCB0byBpbnN0YWxsIG11bHRpcGxlIG1vZHVsZXMg
YXQgb25jZSwgd2hpY2gKICAgICAgICAgICAgIGFyZSBzZXBhcmF0ZWQgYnkgc3BhY2UuIEV4YW1w
bGU6CiAgICAgICAgICAgICBJbnN0YWxsIHNsb3cgdHJhaW4gdmlydCBtb2R1bGU6IC0taW5zdGFs
bC1tb2R1bGUgJ3ZpcnQ6cmhlbCcKICAgICAgICAgICAgIEluc3RhbGwgZmFzdCB0cmFpbiB2aXJ0
IG1vZHVsZTogLS1pbnN0YWxsLW1vZHVsZSAndmlydDo4LjAnCiAgICAgICAgICAgICAnJycKICAg
ICkKICAgIHBhcnNlci5hZGRfYXJndW1lbnQoCiAgICAgICAgJy0taW5zdGFsbC1yZXBvcGtnJywK
ICAgICAgICBhY3Rpb249InN0b3JlIiwKICAgICAgICBoZWxwPScnJwogICAgICAgICAgICAgSW5z
dGFsbCB0aGUgcGFja2FnZSBhbmQgdGhlIGRlcGVuZGVuY2llcyBmcm9tIGFueSBlbmFibGVkIHJl
cG9zaXRvcnkuIFN1cHBvcnQgdG8gaW5zdGFsbCBtdWx0aXBsZQogICAgICAgICAgICAgcGFja2Fn
ZXMgYXQgb25jZSwgd2hpY2ggYXJlIHNlcGFyYXRlZCBieSBzcGFjZS4gRXhhbXBsZToKICAgICAg
ICAgICAgIEluc3RhbGwgcWVtdS1rdm0gYW5kIHFlbXUta3ZtLWRlYnVnaW5mbzogLS1pbnN0YWxs
LXJlcG9wa2cgJ3FlbXUta3ZtIHFlbXUta3ZtLWRlYnVnaW5mbycKICAgICAgICAgICAgICcnJwog
ICAgKQogICAgcGFyc2VyLmFkZF9hcmd1bWVudCgKICAgICAgICAnLS1pbnN0YWxsLWJyZXdwa2cn
LAogICAgICAgIGFjdGlvbj0ic3RvcmUiLAogICAgICAgIGhlbHA9JycnCiAgICAgICAgICAgICBJ
bnN0YWxsIHRoZSBwYWNrYWdlIGFuZCB0aGUgZGVwZW5kZW5jaWVzIGZyb20gYnJldy4gU3VwcG9y
dCB0byBpbnN0YWxsIG11bHRpcGxlIHBhY2thZ2VzIGF0IG9uY2UsCiAgICAgICAgICAgICB3aGlj
aCBhcmUgc2VwYXJhdGVkIGJ5IHNwYWNlLiBFeGFtcGxlOgogICAgICAgICAgICAgSW5zdGFsbCBz
cGVjaWZpZWQgcWVtdTogLS1pbnN0YWxsLWJyZXdwa2cgJ3FlbXUta3ZtLXJoZXYtMi4xMi4wLTIx
LmVsNycKICAgICAgICAgICAgIEluc3RhbGwgdGhlIGxhdGVzdCBwYWNrYWdlOiAtLWluc3RhbGwt
YnJld3BrZyAncWVtdS1rdm0tcmhldkByaGV2aC1yaGVsLTcuNi1jYW5kaWRhdGUnCiAgICAgICAg
ICAgICBJbnN0YWxsIHRoZSBzcGVjaWZpYyBSUE1zOgogICAgICAgICAgICAgLS1pbnN0YWxsLWJy
ZXdwa2cgJ3FlbXUta3ZtLXJoZXZAcmhldmgtcmhlbC03LjYtY2FuZGlkYXRlL3FlbXUtaW1nLXJo
ZXYscWVtdS1rdm0tcmhldicKICAgICAgICAgICAgIEluc3RhbGwgdGhlIHNwZWNpZmljIFJQTXMg
d2l0aCBzcGVjaWZpYyBhcmNoaXRlY3R1cmU6CiAgICAgICAgICAgICAtLWluc3RhbGwtYnJld3Br
ZyAncWVtdS1rdm0tcmhldkByaGV2aC1yaGVsLTcuNi1jYW5kaWRhdGUvcWVtdS1pbWctcmhldixx
ZW11LWt2bS1yaGV2L3BwYzY0bGUsbm9hcmNoJwogICAgICAgICAgICAgJycnCiAgICApCiAgICBw
YXJzZXIuYWRkX2FyZ3VtZW50KAogICAgICAgICctLWluc3RhbGwtdmlydHFlbXUnLAogICAgICAg
IGFjdGlvbj0ic3RvcmUiLAogICAgICAgIGhlbHA9JycnCiAgICAgICAgICAgICBJbnN0YWxsIHFl
bXUgYW5kIHFlbXUgZGVwZW5kZW5jaWVzIGluY2x1ZGVkIGEgdmlydCBtb2R1bGUuIE90aGVyIHBh
Y2thZ2VzIGxpa2UgbGlidmlydCB3b3VsZG4ndCBiZQogICAgICAgICAgICAgaW5zdGFsbGVkLiBU
aGUgYXJndW1lbnQgY291bGQgbW9kdWxlIGlkLCBxZW11IHBhY2thZ2UsIGtvamkgdGFnLCBhbmQg
bW9kdWxlIG5hbWUgd2l0aCBzdHJlYW0uIEV4YW1wbGU6CiAgICAgICAgICAgICBNb2R1bGUgaWQ6
IC0taW5zdGFsbC12aXJ0cWVtdSAnMzE0MycKICAgICAgICAgICAgIFFFTVUgcGFja2FnZTogLS1p
bnN0YWxsLXZpcnRxZW11ICdxZW11LWt2bS0yLjEyLjAtNjkubW9kdWxlK2VsOC4xLjArMzE0Mys0
NTdmOTg0YycKICAgICAgICAgICAgIEtvamkgdGFnOiAtLWluc3RhbGwtdmlydHFlbXUgJ21vZHVs
ZS12aXJ0LXJoZWwtODAxMDAyMDE5MDUwMzAwMDE0Mi1jZGMxMjAyYicKICAgICAgICAgICAgIE1v
ZHVsZSBuYW1lOiAtLWluc3RhbGwtdmlydHFlbXUgJ3ZpcnQ6cmhlbDo4LjEuMCcgb3IgLS1pbnN0
YWxsLXZpcnRxZW11ICd2aXJ0OjguMDo4LjAuMScgb3IKICAgICAgICAgICAgICAgICAgICAgICAg
ICAtLWluc3RhbGwtdmlydHFlbXUgJ3ZpcnQ6YXY6OC40LjAnKGZyb20gQVYtOC40LCBzdHJlYW0g
bmFtZSBjaGFuZ2UgdG8gJ2F2JykKICAgICAgICAgICAgICcnJwogICAgKQogICAgcGFyc2VyLmFk
ZF9hcmd1bWVudCgKICAgICAgICAnLXYnLCAnLS12ZXJib3NlJywKICAgICAgICBhY3Rpb249InN0
b3JlX3RydWUiLAogICAgICAgIGRlZmF1bHQ9RmFsc2UsCiAgICAgICAgaGVscD0nJycKICAgICAg
ICAgICAgIGdpdmUgZGV0YWlsZWQgb3V0cHV0CiAgICAgICAgICAgICAnJycKICAgICkKICAgIHBh
cnNlci5hZGRfYXJndW1lbnQoCiAgICAgICAgJy1xJywgJy0tcXVpZXQnLAogICAgICAgIGFjdGlv
bj0ic3RvcmVfdHJ1ZSIsCiAgICAgICAgZGVmYXVsdD1GYWxzZSwKICAgICAgICBoZWxwPScnJwog
ICAgICAgICAgICAgZ2l2ZSBsZXNzIG91dHB1dAogICAgICAgICAgICAgJycnCiAgICApCiAgICBw
YXJzZXIuYWRkX2FyZ3VtZW50KAogICAgICAgICctZCcsICctLWRvd25ncmFkZScsCiAgICAgICAg
YWN0aW9uPSJzdG9yZV90cnVlIiwKICAgICAgICBkZWZhdWx0PUZhbHNlLAogICAgICAgIGhlbHA9
JycnCiAgICAgICAgICAgICBkb3duZ3JhZGUgbW9kdWxlIHZlcnNpb24gd2hlbiB0aGVyZSBpcyBu
byBhdmFpbGFibGUgbW9kdWxlIGZvciBjdXJyZW50IHJlbGVhc2UKICAgICAgICAgICAgICcnJwog
ICAgKQogICAgcmV0dXJuIHZhcnMocGFyc2VyLnBhcnNlX2FyZ3MoKSkKCmlmIF9fbmFtZV9fID09
ICJfX21haW5fXyI6CiAgICBvcHRzID0gcGFyc2Vfb3B0cygpCiAgICBpZiBvcHRzLmdldCgidmVy
Ym9zZSIpOgogICAgICAgIExPR19MVkwgPSA0CiAgICBpZiBvcHRzLmdldCgicXVpZXQiKToKICAg
ICAgICBRVUlFVCA9IFRydWUKICAgIGlmIG9wdHMuZ2V0KCJkb3duZ3JhZGUiKToKICAgICAgICBE
T1dOR1JBREUgPSBUcnVlCiAgICBpZiBfaGFzX2NtZCgncHl0aG9uMycpOgogICAgICAgIFBZVEhP
Tl9NT0RVTEVfTElTVCA9ICJweXRob24zLXB5eWFtbCIKCiAgICBnZXRfcmVsZWFzZV92ZXJzaW9u
KCkKICAgIGlmIF9oYXNfY21kKCdkbmYnKSBhbmQgcmVsZWFzZV92ZXJzaW9uIDwgJzknOgogICAg
ICAgIFBLR19NR01UX0JJTj0iZG5mIgogICAgICAgIF9pbnN0YWxsX3BrZ19saXN0KFBZVEhPTl9N
T0RVTEVfTElTVCkKICAgICAgICBlbmFibGVfbW9kKG9wdHMuZ2V0KCJlbmFibGVfbW9kdWxlIikp
CiAgICAgICAgZGlzYWJsZV9tb2Qob3B0cy5nZXQoImRpc2FibGVfbW9kdWxlIikpCiAgICAgICAg
aW5zdGFsbF9tb2Qob3B0cy5nZXQoImluc3RhbGxfbW9kdWxlIikpCiAgICAgICAgaW5zdGFsbF92
aXJ0X3FlbXVfZnJvbV9icmV3KG9wdHMuZ2V0KCJpbnN0YWxsX3ZpcnRxZW11IikpCiAgICBpbnN0
YWxsX3BrZ19mcm9tX3JlcG8ob3B0cy5nZXQoImluc3RhbGxfcmVwb3BrZyIpKQogICAgaW5zdGFs
bF9wa2dfZnJvbV9icmV3KG9wdHMuZ2V0KCJpbnN0YWxsX2JyZXdwa2ciKSkK
EOF
chmod a+rx /root/component_management.py
## End 'component_management.py'

# Remove the kernel args we dont like
grubby --remove-args="rhgb quiet" --update-kernel=$(grubby --default-kernel)

sed -i 's/^SELINUX=.*/SELINUX=disabled/g' /etc/selinux/config
systemctl enable kdump.service
systemctl enable rpcbind.service
systemctl enable NetworkManager.service
systemctl enable sshd.service
systemctl enable nfs-server.service
systemctl disable firewalld.service
systemctl disable user.slice

# change the open files and the core size
host_memory_amount=$(awk '( $1 == "MemTotal:" ) { printf "%d", $2/1024/1024 }' /proc/meminfo)
echo "ProcessSizeMax=${host_memory_amount}G" >> /etc/systemd/coredump.conf
echo "ExternalSizeMax=${host_memory_amount}G" >> /etc/systemd/coredump.conf
echo "*               hard    nofile            8192" >> /etc/security/limits.conf

git config --system http.proxy http://squid.corp.redhat.com:3128
%end

%packages --ignoremissing
dosfstools
edk2-ovmf
gcc
gcc-c++
glibc-headers
git
gstreamer1-plugins-good
httpd
iproute
iputils
iscsi-initiator-utils
lftp
mkisofs
nfs-utils
nmap-ncat
numactl
patch
python3-devel
python3-gobject
python3-pillow
rpcbind
screen
sg3_utils
sysstat
targetcli
tcpdump
telnet
telnet-server
vsftpd
xinetd
%end
]]></ks>
