<ks><![CDATA[
rootpw --iscrypted $1$bPnySNFo$QCqmVA1sHhddG7v.ivCbA0

%post
##install certificate
curl -kL 'https://password.corp.redhat.com/RH-IT-Root-CA.crt' -o /etc/pki/ca-trust/source/anchors/RH-IT-Root-CA.crt
curl -kL 'https://password.corp.redhat.com/legacy.crt' -o /etc/pki/ca-trust/source/anchors/legacy.crt
curl -kL 'https://engineering.redhat.com/Eng-CA.crt' -o /etc/pki/ca-trust/source/anchors/Eng-CA.crt
update-ca-trust enable
update-ca-trust extract

## Generate 'setup_bridge.sh'
base64 -d <<EOF > /root/setup_bridge.sh
IyEvYmluL2Jhc2gKCl9zZXR1cF9icmlkZ2UoKQp7CiAgICAjR2V0IHRoZSBFdGhlcm5ldCBpbnRl
cmZhY2UKICAgIE5ERVY9JChpcCByb3V0ZSB8IGdyZXAgZGVmYXVsdCB8IGdyZXAgLVBvICcoPzw9
ZGV2ICkoXFMrKScgfCBhd2sgJ0JFR0lOeyBSUyA9ICIiIDsgRlMgPSAiXG4iIH17cHJpbnQgJDF9
JykKICAgICNHZXQgY29ubmVjdGlvbiBuYW1lCiAgICBDT05JRD0kKG5tY2xpIGRldmljZSBzaG93
ICROREVWIHwgYXdrIC1GOiAnL0dFTkVSQUwuQ09OTkVDVElPTi8ge3ByaW50ICQyfScgfCBhd2sg
J3skMT0kMX0xJykKCiAgICBubWNsaSBjb24gYWRkIHR5cGUgYnJpZGdlIGlmbmFtZSAiJEJSSURH
RV9JRk5BTUUiIGNvbi1uYW1lICIkQlJJREdFX0lGTkFNRSIgc3RwIG5vCiAgICBubWNsaSBjb24g
bW9kaWZ5ICIkQ09OSUQiIG1hc3RlciAiJEJSSURHRV9JRk5BTUUiCiAgICBubWNsaSBjb24gdXAg
IiRDT05JRCIKICAgIFsgJD8gLW5lIDAgXSAmJiBlY2hvICJOZXR3b3JrTWFuYWdlciBDb21tYW5k
IGZhaWxlZCIgJiYgZXhpdCAxCn0KCl9jaGtfYnJpZGdlX2Rldl9pcCgpCnsKICAgICMjIENoZWNr
IHdoZXRoZXIgYnJpZGdlIGRldmljZSBnZXRzIGlwIGFkZHJlc3MKICAgIFNUQVJUPWBkYXRlICsl
c2AKICAgIHdoaWxlIFsgJCgoICQoZGF0ZSArJXMpIC0gMTIwICkpIC1sdCAkU1RBUlQgXTsgZG8K
ICAgICAgICBJUF9BRERSPSQoaXAgYWRkcmVzcyBzaG93ICIkQlJJREdFX0lGTkFNRSIgfCBncmVw
ICJpbmV0XGIiIHwgYXdrICd7cHJpbnQgJDJ9JyB8IGN1dCAtZC8gLWYxKQogICAgICAgIFtbIC1u
ICIkSVBfQUREUiIgXV0gJiYgZWNobyAiaXAgYWRkcmVzcyBvZiBicmlkZ2UgZGV2aWNlICckQlJJ
REdFX0lGTkFNRSc6ICRJUF9BRERSIiAmJiBleGl0IDAKICAgICAgICBzbGVlcCA1CiAgICBkb25l
CiAgICBlY2hvICJGYWlsIHRvIGdldCBpcCBhZGRyZXNzIG9mIGJyaWRnZSBkZXZpY2UgJyRCUklE
R0VfSUZOQU1FJyBpbiAyIG1pbnMiCiAgICBleGl0IDEKfQoKQlJJREdFX0lGTkFNRT0nc3dpdGNo
JwoKX3NldHVwX2JyaWRnZQpfY2hrX2JyaWRnZV9kZXZfaXAK
EOF
chmod a+rx /root/setup_bridge.sh

## Adding qemu-ifup/down scripts to help manually debugging
base64 -d <<EOF > /etc/qemu-ifup
IyEvYmluL3NoCnN3aXRjaD1zd2l0Y2gKL3Vzci9zYmluL2lwIGxpbmsgc2V0ICQxIHVwCi91c3Iv
c2Jpbi9pcCBsaW5rIHNldCBkZXYgJDEgbWFzdGVyICR7c3dpdGNofQovdXNyL3NiaW4vaXAgbGlu
ayBzZXQgJHtzd2l0Y2h9IHR5cGUgYnJpZGdlIGZvcndhcmRfZGVsYXkgMAovdXNyL3NiaW4vaXAg
bGluayBzZXQgJHtzd2l0Y2h9IHR5cGUgYnJpZGdlIHN0cF9zdGF0ZSAwCg==
EOF

base64 -d <<EOF > /etc/qemu-ifdown
IyEvYmluL3NoCnN3aXRjaD1zd2l0Y2gKL3Vzci9zYmluL2lwIGxpbmsgc2V0ICQxIGRvd24KL3Vz
ci9zYmluL2lwIGxpbmsgc2V0IGRldiAkMSBub21hc3Rlcgo=
EOF
chmod a+rx /etc/qemu-if*
## End adding qemu-ifup/down scripts

## Install brewkoji
curl -kL 'http://download.eng.bos.redhat.com/rel-eng/internal/rcm-tools-rhel-8-baseos.repo' -o /etc/yum.repos.d/rcm-tools-rhel-8.repo
dnf install brewkoji -y
## End brewkoji installation

## Generate 'component_management.py'
base64 -d <<EOF > /root/component_management.py
aW1wb3J0IGFyZ3BhcnNlCmltcG9ydCBqc29uCmltcG9ydCBvcwppbXBvcnQgcGxhdGZvcm0KaW1w
b3J0IHJlCmltcG9ydCByZXF1ZXN0cwppbXBvcnQgc2h1dGlsCmltcG9ydCBzdWJwcm9jZXNzCmlt
cG9ydCBzeXMKCgojIEdsb2JhbCB2YXJpYWJsZXMKUk9PVF9ESVIgPSBvcy5wYXRoLmFic3BhdGgo
b3MucGF0aC5kaXJuYW1lKF9fZmlsZV9fKSkKUVVJRVQgPSBGYWxzZQpMT0dfTFZMID0gMQpQS0df
TUdNVF9CSU4gPSAieXVtIgpCUkVXX1VSTCA9ICJodHRwOi8vZG93bmxvYWQuZGV2ZWwucmVkaGF0
LmNvbSIKTUJTX1VSTCA9ICJodHRwczovL21icy5lbmdpbmVlcmluZy5yZWRoYXQuY29tL21vZHVs
ZS1idWlsZC1zZXJ2aWNlLzEvbW9kdWxlLWJ1aWxkcyIKUFlUSE9OX01PRFVMRV9MSVNUID0gInB5
dGhvbjItcHl5YW1sIgoKCiMgQSBjb2xsZWN0aW9uIG9mIFB5dGhvbiB1dGlsaXRpZXMgZnVuY3Rp
b25zCmRlZiBfbG9nKGx2bCwgbXNnKToKICAgICIiIlByaW50IGEgbWVzc2FnZSB3aXRoIGxldmVs
ICdsdmwnIHRvIENvbnNvbGUiIiIKICAgIGlmIG5vdCBRVUlFVCBhbmQgbHZsIDw9IExPR19MVkw6
CiAgICAgICAgcHJpbnQobXNnKQoKZGVmIF9sb2dfZGVidWcobXNnKToKICAgICIiIlByaW50IGEg
bWVzc2FnZSB3aXRoIGxldmVsIERFQlVHIHRvIENvbnNvbGUiIiIKICAgIG1zZyA9ICJcMDMzWzk2
bURFQlVHOiAiICsgbXNnICsgIlwwMzNbMDBtIgogICAgX2xvZyg0LCBtc2cpCgpkZWYgX2xvZ19p
bmZvKG1zZyk6CiAgICAiIiJQcmludCBhIG1lc3NhZ2Ugd2l0aCBsZXZlbCBJTkZPIHRvIENvbnNv
bGUiIiIKICAgIG1zZyA9ICJcMDMzWzkybUlORk86ICIgKyBtc2cgKyAiXDAzM1swMG0iCiAgICBf
bG9nKDMsIG1zZykKCmRlZiBfbG9nX3dhcm4obXNnKToKICAgICIiIlByaW50IGEgbWVzc2FnZSB3
aXRoIGxldmVsIFdBUk4gdG8gQ29uc29sZSIiIgogICAgbXNnID0gIlwwMzNbOTNtV0FSTjogIiAr
IG1zZyArICJcMDMzWzAwbSIKICAgIF9sb2coMiwgbXNnKQoKZGVmIF9sb2dfZXJyb3IobXNnKToK
ICAgICIiIlByaW50IGEgbWVzc2FnZSB3aXRoIGxldmVsIEVSUk9SIHRvIENvbnNvbGUiIiIKICAg
IG1zZyA9ICJcMDMzWzkxbUVSUk9SOiAiICsgbXNnICsgIlwwMzNbMDBtIgogICAgX2xvZygxLCBt
c2cpCgpkZWYgX3N5c3RlbV9zdGF0dXNfb3V0cHV0KGNtZCk6CiAgICAiIiJSdW4gYSBzdWJwcm9j
ZXNzLCByZXR1cm5pbmcgaXRzIGV4aXQgY29kZSBhbmQgb3V0cHV0LiIiIgogICAgc3AgPSBzdWJw
cm9jZXNzLlBvcGVuKGNtZCwgc3Rkb3V0PXN1YnByb2Nlc3MuUElQRSwKICAgICAgICAgICAgICAg
ICAgICAgICAgICBzdGRlcnI9c3VicHJvY2Vzcy5QSVBFLCBzaGVsbD1UcnVlKQogICAgc3Rkb3V0
LCBzdGRlcnIgPSBzcC5jb21tdW5pY2F0ZSgpCiAgICAjIyBXYWl0IGZvciBjb21tYW5kIHRvIHRl
cm1pbmF0ZS4gR2V0IHJldHVybiByZXR1cm5jb2RlICMjCiAgICBzdGF0dXMgPSBzcC53YWl0KCkK
ICAgIHJldHVybiAoc3RhdHVzLCBzdGRvdXQuZGVjb2RlKCksIHN0ZGVyci5kZWNvZGUoKSkKCmRl
ZiBfc3lzdGVtKGNtZCk6CiAgICAiIiJSdW4gYSBzdWJwcm9jZXNzLCByZXR1cm5pbmcgaXRzIGV4
aXQgY29kZS4iIiIKICAgIHJldHVybiBfc3lzdGVtX3N0YXR1c19vdXRwdXQoY21kKVswXQoKZGVm
IF9zeXN0ZW1fb3V0cHV0KGNtZCk6CiAgICAiIiJSdW4gYSBzdWJwcm9jZXNzLCByZXR1cm5pbmcg
aXRzIG91dHB1dC4iIiIKICAgIHJldHVybiBfc3lzdGVtX3N0YXR1c19vdXRwdXQoY21kKVsxXQoK
ZGVmIF9ydW5fY21kKGNtZCk6CiAgICAiIiIKICAgIFJ1biBhIHN1YnByb2Nlc3MsIHJldHVybmlu
ZyBpdHMgZXhpdCBjb2RlIGFuZCBwcmludCBzdGRvdXQvc3RkZXJyCiAgICB0byBDb25zb2xlLgog
ICAgIiIiCiAgICBpZiBRVUlFVCBvciBMT0dfTFZMIDw9IDE6CiAgICAgICAgcmV0dXJuIF9zeXN0
ZW1fc3RhdHVzX291dHB1dChjbWQpWzBdCiAgICBlbHNlOgogICAgICAgIG1zZyA9ICJcMDMzWzFt
PT4gJXNcMDMzWzBtIiAlIGNtZAogICAgICAgIF9sb2coTE9HX0xWTCwgbXNnKQogICAgICAgIHNw
ID0gc3VicHJvY2Vzcy5Qb3BlbihjbWQsIHNoZWxsPVRydWUpCiAgICAgICAgcmV0dXJuIHNwLndh
aXQoKQoKZGVmIF9leGl0KHJldCk6CiAgICAiIiJFeGl0IGZyb20gcHl0aG9uIGFjY29yZGluZyB0
byB0aGUgZ2l2aW5nIGV4aXQgY29kZSIiIgogICAgaWYgcmV0ICE9IDA6CiAgICAgICAgX2xvZyhM
T0dfTFZMLCAiUGxlYXNlIGhhbmRsZSB0aGUgRVJST1IocykgYW5kIHJlLXJ1biB0aGlzIHNjcmlw
dCIpCiAgICBzeXMuZXhpdChyZXQpCgpkZWYgX2V4aXRfb25fZXJyb3IocmV0LCBtc2cpOgogICAg
IiIiUHJpbnQgdGhlIGVycm9yIG1lc3NhZ2UgYW5kIGV4aXQgZnJvbSBweXRob24gd2hlbiBsYXN0
IGNvbW1hbmQgZmFpbHMiIiIKICAgIGlmIHJldCAhPSAwOgogICAgICAgIF9sb2dfZXJyb3IobXNn
KQogICAgICAgIF9leGl0KDEpCgpkZWYgX3dhcm5fb25fZXJyb3IocmV0LCBtc2cpOgogICAgIiIi
UHJpbnQgdGhlIHdhcm4gbWVzc2FnZSB3aGVuIGxhc3QgY29tbWFuZCBmYWlscyIiIgogICAgaWYg
cmV0ICE9IDA6CiAgICAgICAgX2xvZ193YXJuKG1zZykKICAgIApkZWYgX2hhc19jbWQoY21kKToK
ICAgICIiIkNoZWNrIHdoZXRoZXIgYSBwcm9ncmFtIGlzIGluc3RhbGxlZCIiIgogICAgcmV0dXJu
IF9zeXN0ZW0oImNvbW1hbmQgLXYgJXMiICUgY21kKSA9PSAwCgpkZWYgX2hhc19ycG0ocGtnKToK
ICAgICIiIkNoZWNrIHdoZXRoZXIgYSBwYWNrYWdlIGlzIGluc3RhbGxlZCIiIgogICAgcmV0dXJu
IF9zeXN0ZW0oInJwbSAtcSAlcyIgJSBwa2cpCgpkZWYgX2hhc19tb2Rfc3BlYyhtb2Rfc3BlYyk6
CiAgICAiIiJDaGVjayB3aGV0aGVyIGEgbW9kdWxlIG9yIG1vZHVsZSBzdHJlYW0gY291bGQgYmUg
dXNlZCIiIgogICAgcmV0dXJuIF9zeXN0ZW0oIiVzIG1vZHVsZSBpbmZvICVzIiAlIChQS0dfTUdN
VF9CSU4sIG1vZF9zcGVjKSkKCmRlZiBfY2hrX21vZF9lbmFibGVkKG1vZF9zcGVjKToKICAgICIi
IkNoZWNrIHdoZXRoZXIgYSBtb2R1bGUgb3IgbW9kdWxlIHN0cmVhbSBpcyBlbmFibGVkIiIiCiAg
ICByZXR1cm4gX3N5c3RlbSgiJXMgbW9kdWxlIGxpc3QgLS1lbmFibGVkICVzIiAlIChQS0dfTUdN
VF9CSU4sIG1vZF9zcGVjKSkKCmRlZiBfY2hrX21vZF9kaXNhYmxlZChtb2Rfc3BlYyk6CiAgICAi
IiJDaGVjayB3aGV0aGVyIGEgbW9kdWxlIG9yIG1vZHVsZSBzdHJlYW0gaXMgZGlzYWJsZWQiIiIK
ICAgIHJldHVybiBfc3lzdGVtKCIlcyBtb2R1bGUgbGlzdCAtLWRpc2FibGVkICVzIiAlIChQS0df
TUdNVF9CSU4sIG1vZF9zcGVjKSkKCmRlZiBfY2hrX21vZF9pbnN0YWxsZWQobW9kX3NwZWMpOgog
ICAgIiIiQ2hlY2sgd2hldGhlciBhIG1vZHVsZSBvciBtb2R1bGUgc3RyZWFtIGlzIGluc3RhbGxl
ZCIiIgogICAgcmV0dXJuIF9zeXN0ZW0oIiVzIG1vZHVsZSBsaXN0IC0taW5zdGFsbGVkICVzIiAl
IChQS0dfTUdNVF9CSU4sIG1vZF9zcGVjKSkKCmRlZiBfcGFyc2VfYnJld19wa2coYnJld19wa2cp
OgogICAgIiIiCiAgICBQYXJzZSB0aGUgYXJndW1lbnQgdG8gZ2V0IGluZm9ybWF0aW9uIG9mIGJy
ZXcgcGFja2FnZS4KICAgIDogcmV0dXJuIGJ1aWxkOiAgQnVpbGQgbmFtZSBleHBlY3RlZCB0byBi
ZSBpbnN0YWxsZWQKICAgIDogcmV0dXJuIHBrZ3M6ICAgUlBNcyBsaXN0IGluY2x1ZGVkIGluIHRo
ZSBidWlsZCB3aGljaCBhcmUgZXhwZWN0ZWQgdG8gYmUKICAgICAgICAgICAgICAgICAgICAgaW5z
dGFsbGVkLiBJZiBOb25lLCBhbGwgdGhlIFJQTXMgaW5jbHVkZWQgaW4gdGhlIGJ1aWxkCiAgICAg
ICAgICAgICAgICAgICAgIHdpbGwgYmUgaW5zdGFsbGVkCiAgICA6IHJldHVybiBhcmNoZXM6IEFy
Y2hpdGVjdHVyZSBzcGVjaWZpZWQgUlBNcyB3aWxsIGJlIGluc3RhbGxlZC4gSWYgTm9uZSwKICAg
ICAgICAgICAgICAgICAgICAgdGhlIGRlZmF1bHQgdmFsdWUgYXJlIHRoZSBob3N0IG1hY2hpbmUg
dHlwZSBhbmQgbm9hcmNoCiAgICAiIiIKICAgIGJ1aWxkID0gYnJld19wa2cuc3BsaXQoJy8nKVsw
XQogICAgdGFnID0gJycKICAgIHBrZ3MgPSAnJwogICAgYXJjaGVzID0gcGxhdGZvcm0ubWFjaGlu
ZSgpCiAgICBpZiBidWlsZC5maW5kKCJAIikgPj0gMDoKICAgICAgICB0YWcgPSBidWlsZC5zcGxp
dCgnQCcpWzFdCiAgICAgICAgYnVpbGQgPSBidWlsZC5zcGxpdCgnQCcpWzBdCiAgICAgICAgY21k
ID0gImJyZXcgbGF0ZXN0LWJ1aWxkICVzICVzIC0tcXVpZXQgMj4mMSIgJSAodGFnLCBidWlsZCkK
ICAgICAgICAocmV0LCBvdXQsIF8pID0gX3N5c3RlbV9zdGF0dXNfb3V0cHV0KGNtZCkKICAgICAg
ICBfZXhpdF9vbl9lcnJvcihyZXQsICJGYWlsZWQgdG8gZ2V0IHRoZSBsYXRlc3QgYnVpbGQgb2Yg
JyVzICglcyknLCIKICAgICAgICAgICAgICAgICAgICAgICAiIGNvbW1hbmQgb3V0cHV0OlxuJXMi
ICUgKGJ1aWxkLCB0YWcsIG91dCkpCiAgICAgICAgYnVpbGQgPSBvdXQuc3BsaXQoKVswXQogICAg
aWYgYnJld19wa2cuY291bnQoIi8iKSA+PSAxOgogICAgICAgIHBrZ3MgPSBicmV3X3BrZy5zcGxp
dCgnLycpWzFdCiAgICBpZiBicmV3X3BrZy5jb3VudCgiLyIpID09IDI6CiAgICAgICAgYXJjaGVz
ID0gYnJld19wa2cuc3BsaXQoJy8nKVsyXQogICAgYXJjaGVzICs9ICIsbm9hcmNoIgogICAgcmV0
dXJuIChidWlsZCwgcGtncywgYXJjaGVzKQoKZGVmIF9nZXRfcnBtX2xpc3QoYnVpbGQsIGFyY2hl
cyk6CiAgICAiIiIKICAgIEdldCBSUE1zIGxpc3QgYWNjb3JkaW5nIHRvIGJ1aWxkIG5hbWUgYW5k
IHNwZWNpZmllZCBhcmNoaXRlY2h0dXJlcy4KICAgICIiIgogICAgcnBtX2xpc3QgPSBbXQogICAg
KHJldCwgb3V0LCBfKSA9IF9zeXN0ZW1fc3RhdHVzX291dHB1dCgiYnJldyBidWlsZGluZm8gJXMg
Mj4mMSIgJSBidWlsZCkKICAgIF9leGl0X29uX2Vycm9yKHJldCwgIkZhaWxlZCB0byBnZXQgYnVp
bGQgaW5mb21hdGlvbiBvZiAnJXMnLCBjb21tYW5kIgogICAgICAgICAgICAgICAgICAgIiBvdXRw
dXQ6XG4lcyIgJSAoYnVpbGQsIG91dCkpCiAgICBycG1zID0gcmUuc2VhcmNoKHIiUlBNc1xzKjpc
cyooW146XSopIiwgb3V0LCByZS5JKS5ncm91cCgxKQogICAgZm9yIHJwbSBpbiBycG1zLnNwbGl0
bGluZXMoKToKICAgICAgICBmb3IgYXJjaCBpbiBhcmNoZXMuc3BsaXQoJywnKToKICAgICAgICAg
ICAgaWYgcnBtLmZpbmQoIiVzLnJwbSIgJSBhcmNoKSA+PSAwOgogICAgICAgICAgICAgICAgcnBt
X2xpc3QuYXBwZW5kKHJwbS5yZXBsYWNlKCIvbW50L3JlZGhhdCIsIEJSRVdfVVJMKSkKICAgIHJl
dHVybiBycG1fbGlzdAoKZGVmIF9nZXRfcmVxdWlyZWRfcnBtX2xpc3QocnBtX2xpc3QsIHBrZ3Mp
OgogICAgIiIiCiAgICBHZXQgcmVxdWlyZWQgUlBNcyBmcm9tIHRoZSBSUE1zIGxpc3QuIElmIG5v
IHNwZWNpZmljIFJQTXMgYXJlIHNwZWNpZmllZCwKICAgIGFsbCB0aGUgUlBNcyBpbiB0aGUgbGlz
dCB3aWxsIGJlIGV4cGVjdGVkIHRvIGJlIGluc3RhbGxlZC4KICAgICIiIgogICAgcmVxX3JwbV9s
aXN0ID0gW10KICAgIGlmIG5vdCBwa2dzOgogICAgICAgIHJldHVybiBycG1fbGlzdAogICAgZm9y
IHBrZyBpbiBwa2dzLnNwbGl0KCcsJyk6CiAgICAgICAgaGFzX3BrZyA9IEZhbHNlCiAgICAgICAg
Zm9yIHJwbSBpbiBycG1fbGlzdDoKICAgICAgICAgICAgaWYgcnBtLmZpbmQoJy8nKSA+PSAwOgog
ICAgICAgICAgICAgICAgcGtnX25hbWUgPSBycG0ucnNwbGl0KCcvJywgMSlbMV0ucnNwbGl0KCct
JywgMilbMF0KICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHBrZ19uYW1lID0gcnBt
LnJzcGxpdCgnLScsIDIpWzBdCiAgICAgICAgICAgIGlmIHBrZ19uYW1lID09IHBrZzoKICAgICAg
ICAgICAgICAgIGhhc19wa2cgPSBUcnVlCiAgICAgICAgICAgICAgICByZXFfcnBtX2xpc3QuYXBw
ZW5kKHJwbSkKICAgICAgICBpZiBub3QgaGFzX3BrZzoKICAgICAgICAgICAgX2xvZ19pbmZvKCIn
JXMnIGlzIG5vdCBpbiAnJXMnLCBza2lwcGVkIiAlIChwa2csIHJwbV9saXN0KSkKICAgIHJldHVy
biByZXFfcnBtX2xpc3QgaWYgcmVxX3JwbV9saXN0IGVsc2UgcnBtX2xpc3QKCmRlZiBfZ2V0X21v
ZF9pbmZvX2Zyb21fbWJzKG1vZF9pZCk6CiAgICAiIiIKICAgIEdldCBtb2R1bGUgaW5mb3JtYXRp
b24gYWNjb3JkaW5nIHRvIHRoZSBtb2R1bGUgaWQgZnJvbSBNQlMuCiAgICAiIiIKICAgIG1vZF9p
bmZvID0ge30KICAgIHVybCA9IE1CU19VUkwgKyAnLycgKyBtb2RfaWQKICAgIHJlc3BvbnNlID0g
anNvbi5sb2FkcyhyZXF1ZXN0cy5nZXQodXJsKS50ZXh0KQogICAgbW9kX2luZm9bJ3N0YXRlX25h
bWUnXSA9IHJlc3BvbnNlLmdldCgic3RhdGVfbmFtZSIpCiAgICBtb2RfaW5mb1snc2NtdXJsJ10g
PSByZXNwb25zZS5nZXQoInNjbXVybCIpCiAgICBtb2RfaW5mb1sna29qaV90YWcnXSA9IHJlc3Bv
bnNlLmdldCgia29qaV90YWciKQogICAgbW9kX2luZm9bJ3JwbXMnXSA9IHJlc3BvbnNlLmdldCgi
dGFza3MiKS5nZXQoInJwbXMiKQogICAgcmV0dXJuIG1vZF9pbmZvCgpkZWYgX2NoZWNrX21vZHVs
ZV9pc19yZWFkeShtb2RfaWQpOgogICAgIiIiCiAgICBDaGVjayB3aGV0aGVyIHRoZSBtb2R1bGUg
c3RhdGUgaXMgcmVhZHkuIFdoZW4gdGhlIHN0YXRlIGlzIEZhaWxlZCwgbW9kdWxlCiAgICBzaG91
bGQgbm90IGJlIHVzZWQgZm9yIHRlc3RpbmcuCiAgICAiIiIKICAgIG1vZF9pbmZvID0gX2dldF9t
b2RfaW5mb19mcm9tX21icyhtb2RfaWQpCiAgICBpZiBtb2RfaW5mby5nZXQoJ3N0YXRlX25hbWUn
KSA9PSAicmVhZHkiOgogICAgICAgIHJldHVybiBUcnVlCiAgICByZXR1cm4gRmFsc2UKCmRlZiBf
Z2V0X21vZF9pZF9mcm9tX2tvamlfdGFnKGtvamlfdGFnKToKICAgICIiIgogICAgVXNlIHRoZSBr
b2ppIHRhZyB0byBnZXQgYWxsIHRoZSBjb21wb25lbnRzIGluY2x1ZGVkIGluIHRoZSBtb2R1bGUs
IGFuZCB0aGVuCiAgICBjb21wYXJlIHRoZSBtb2R1bGUgaWQgaW4gZWFjaCBjb21wb25lbnQuIFRo
ZSBtYXhpbXVtIG1vZHVsZSBpZCBzaG91bGQgYmUKICAgIHRoZSBsYXRlc3Qgb25lLgogICAgIiIi
CiAgICBtb2RfaWQgPSBOb25lCiAgICAocmV0LCBjcG50X2xpc3QsIF8pID0gX3N5c3RlbV9zdGF0
dXNfb3V0cHV0KCJicmV3IGxpc3QtdGFnZ2VkICVzIDI+JjEiICUKICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGtvamlfdGFnKQogICAgX2V4aXRfb25fZXJy
b3IocmV0LCAiRmFpbGVkIHRvIGdldCBjb21wb25lbmV0IGxpc3QgJyVzJywgY29tbWFuZCIKICAg
ICAgICAgICAgICAgICAgICIgb3V0cHV0OlxuJXMiICUgKGtvamlfdGFnLCBjcG50X2xpc3QpKQog
ICAgZm9yIGNwbnQgaW4gY3BudF9saXN0LnNwbGl0bGluZXMoKToKICAgICAgICBzZWFyY2hfb2Jq
ID0gcmUuc2VhcmNoKHIibW9kdWxlXCtlbFxkK1wrKFxkKylcKyIsIGNwbnQsIHJlLkkpCiAgICAg
ICAgaWYgbm90IHNlYXJjaF9vYmo6CiAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgaWYgbm90
IG1vZF9pZCBvciBtb2RfaWQgPCBzZWFyY2hfb2JqLmdyb3VwKDEpOgogICAgICAgICAgICBtb2Rf
aWQgPSBzZWFyY2hfb2JqLmdyb3VwKDEpCiAgICByZXR1cm4gbW9kX2lkCgpkZWYgX2dldF9tb2Rf
aWRfZnJvbV9tb2R1bGUobW9kX25hbWUpOgogICAgIiIiCiAgICBHZXQga29qaSB0YWcgZnJvbSBt
b2R1bGUgbmFtZSBhbmQgbW9kdWxlIHN0cmVhbSwgdGhlbiB1c2Uga29qaSB0YWcgdG8gZ2V0CiAg
ICB0aGUgbW9kdWxlIGlkLgogICAgIiIiCiAgICBuYW1lID0gbW9kX25hbWUuc3BsaXQoJzonKVsw
XQogICAgc3RyZWFtID0gbW9kX25hbWUuc3BsaXQoJzonKVsxXQogICAgcGxhdGZvcm1fdGFnID0g
Im1vZHVsZS0lcy0lcyIgJSAobmFtZSwgc3RyZWFtKQogICAgY21kID0gImJyZXcgbGlzdC10YXJn
ZXRzIHwgZ3JlcCAlcyB8IHNvcnQgLXIgMj4mMSIgJSBwbGF0Zm9ybV90YWcKICAgIChyZXQsIGtv
amlfdGFnX2xpc3QsIF8pID0gX3N5c3RlbV9zdGF0dXNfb3V0cHV0KGNtZCkKICAgIF9leGl0X29u
X2Vycm9yKHJldCwgIkZhaWxlZCB0byBnZXQga29qaSB0YWcgb2YgJyVzJywgY29tbWFuZCIKICAg
ICAgICAgICAgICAgICAgICIgb3V0cHV0OlxuJXMiICUgKHBsYXRmb3JtX3RhZywga29qaV90YWdf
bGlzdCkpCiAgICBmb3Iga29qaV90YWcgaW4ga29qaV90YWdfbGlzdC5zcGxpdGxpbmVzKCk6CiAg
ICAgICAgbW9kX2lkID0gX2dldF9tb2RfaWRfZnJvbV9rb2ppX3RhZyhrb2ppX3RhZy5zcGxpdCgp
WzBdKQogICAgICAgIGlmIF9jaGVja19tb2R1bGVfaXNfcmVhZHkobW9kX2lkKToKICAgICAgICAg
ICAgcmV0dXJuIG1vZF9pZAogICAgcmV0dXJuIE5vbmUKCmRlZiBfZ2V0X21vZF9pZF9mcm9tX3Bh
Y2thZ2UocGtnX25hbWUpOgogICAgIiIiCiAgICBHZXQga29qaSB0YWcgZnJvbSBwYWNrYWdlIG5h
bWUuIFRoZW4gZ2V0IHRoZSBtb2R1bGUgaWQgZnJvbSBrb2ppIHRhZy4KICAgIE5vdGljZSB0aGF0
IG5vdCBhbGwgdGhlIGdvdHRlbiBrb2ppIHRhZ3MgY291bGQgYmUgdXNlZC4gU29tZSBvZiB0aGVt
IG1heQogICAgYmUgYmVsb25nZWQgdG8gYSBhYm9ydGVkIG1vZHVsZS4KICAgICIiIgogICAgaWYg
cGtnX25hbWUuc3RhcnRzd2l0aCgibW9kdWxlLXZpcnQiKToKICAgICAgICB0YWdzID0gcGtnX25h
bWUKICAgIGVsc2U6CiAgICAgICAgKHJldCwgb3V0LCBfKSA9IF9zeXN0ZW1fc3RhdHVzX291dHB1
dCgiYnJldyBidWlsZGluZm8gJXMgMj4mMSIgJQogICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgcGtnX25hbWUpCiAgICAgICAgX2V4aXRfb25fZXJyb3IocmV0LCAi
RmFpbGVkIHRvIGdldCBidWlsZCBpbmZvbWF0aW9uIG9mICclcycsIGNvbW1hbmQiCiAgICAgICAg
ICAgICAgICAgICAgICAgIiBvdXRwdXQ6XG4lcyIgJSAocGtnX25hbWUsIG91dCkpCiAgICAgICAg
dGFncyA9IHJlLnNlYXJjaChyIlRhZ3Nccyo6XHMqKC4qKSIsIG91dCwgcmUuSSkuZ3JvdXAoMSkK
ICAgIHRhZ19saXN0ID0gdGFncy5zcGxpdCgpCiAgICB0YWdfbGlzdC5yZXZlcnNlKCkKICAgIGZv
ciBrb2ppX3RhZyBpbiB0YWdfbGlzdDoKICAgICAgICBpZiBrb2ppX3RhZy5lbmRzd2l0aCgiLWJ1
aWxkIik6CiAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgbW9kX2lkID0gX2dldF9tb2RfaWRf
ZnJvbV9rb2ppX3RhZyhrb2ppX3RhZykKICAgICAgICBpZiBfY2hlY2tfbW9kdWxlX2lzX3JlYWR5
KG1vZF9pZCk6CiAgICAgICAgICAgIHJldHVybiBtb2RfaWQKICAgIHJldHVybiBOb25lCgpkZWYg
X2dldF9tb2RfaWQobW9kX2lkKToKICAgICIiIgogICAgR2V0IG1vZHVsZSBpZAogICAgIiIiCiAg
ICBpZiBtb2RfaWQuaXNkaWdpdCgpOgogICAgICAgIHJldHVybiBtb2RfaWQKICAgIGlmIG1vZF9p
ZC5maW5kKCJ2aXJ0OiIpID49IDA6CiAgICAgICAgcmV0dXJuIF9nZXRfbW9kX2lkX2Zyb21fbW9k
dWxlKG1vZF9pZCkKICAgIHJldHVybiBfZ2V0X21vZF9pZF9mcm9tX3BhY2thZ2UobW9kX2lkKQoK
ZGVmIF9nZXRfcnBtX2xpc3RfZnJvbV92aXJ0X3lhbWwobW9kX2luZm8pOgogICAgIiIiCiAgICBH
ZXQgUlBNcyBsaXN0IGZvciB2aXJ0IG1vZHVsZSBmcm9tIHRoZSB5YW1sIGNvbmZpZ3VyYXRpb24u
CiAgICAiIiIKICAgIGltcG9ydCB5YW1sCiAgICByZXBvX2RpciA9IG9zLnBhdGguam9pbihST09U
X0RJUiwgInZpcnQiKQogICAgeWFtbF9jb25mID0gb3MucGF0aC5qb2luKHJlcG9fZGlyLCAidmly
dC55YW1sIikKICAgIHJlcG8gPSBtb2RfaW5mby5nZXQoInNjbXVybCIpLnNwbGl0KCc/IycpWzBd
CiAgICBjb21taXRfaGFzaCA9IG1vZF9pbmZvLmdldCgic2NtdXJsIikuc3BsaXQoJz8jJylbMV0K
ICAgIGlmIG9zLnBhdGguZXhpc3RzKHJlcG9fZGlyKToKICAgICAgICBzaHV0aWwucm10cmVlKHJl
cG9fZGlyKQogICAgKHJldCwgXywgZXJyKSA9IF9zeXN0ZW1fc3RhdHVzX291dHB1dCgiZ2l0IGNs
b25lICVzICVzIiAlIChyZXBvLCByZXBvX2RpcikpCiAgICBfZXhpdF9vbl9lcnJvcihyZXQsICJG
YWlsZWQgdG8gY2xvbmUgcmVwbyAnJXMnLCBFcnJvciBtZXNzYWdlOlxuJXMiICUKICAgICAgICAg
ICAgICAgICAgIChyZXBvLCBlcnIpKQogICAgX3N5c3RlbSgiZ2l0IC1DICVzIGNoZWNrb3V0ICVz
IiAlIChyZXBvX2RpciwgY29tbWl0X2hhc2gpKQogICAgdmlydF9pbmZvID0geWFtbC5sb2FkKG9w
ZW4oeWFtbF9jb25mKSkKICAgIHJwbXNfaW5mbyA9IHZpcnRfaW5mby5nZXQoImRhdGEiKS5nZXQo
ImNvbXBvbmVudHMiKS5nZXQoInJwbXMiKQogICAgcmV0dXJuIHJwbXNfaW5mbwoKZGVmIF9nZXRf
Y3BudF9saXN0X2Zvcl9xZW11KG1vZF9pbmZvKToKICAgICIiIgogICAgR2V0IGNvbXBvbmVudCBs
aXN0IGZvciBxZW11IGFuZCBxZW11IGRlcGVuZGVuY2llcy4KICAgICIiIgogICAgY3BudF9saXN0
ID0gW10KICAgIHJwbXNfaW5mbyA9IF9nZXRfcnBtX2xpc3RfZnJvbV92aXJ0X3lhbWwobW9kX2lu
Zm8pCiAgICBmb3IgcnBtIGluIHJwbXNfaW5mby5rZXlzKCk6CiAgICAgICAgaWYgcnBtc19pbmZv
LmdldChycG0pLmdldCgicmF0aW9uYWxlIikuZmluZCgicWVtdS1rdm0iKSA8IDA6CiAgICAgICAg
ICAgIGNvbnRpbnVlCiAgICAgICAgaWYgbm90IHJwbXNfaW5mby5nZXQocnBtKS5nZXQoImFyY2hl
cyIpOgogICAgICAgICAgICBjcG50X2xpc3QuYXBwZW5kKHJwbSkKICAgICAgICAgICAgY29udGlu
dWUKICAgICAgICBpZiBwbGF0Zm9ybS5tYWNoaW5lKCkgaW4gcnBtc19pbmZvLmdldChycG0pLmdl
dCgiYXJjaGVzIik6CiAgICAgICAgICAgIGNwbnRfbGlzdC5hcHBlbmQocnBtKQogICAgY3BudF9s
aXN0LmFwcGVuZCgncWVtdS1rdm0nKQogICAgcmV0dXJuIGNwbnRfbGlzdAoKZGVmIF9nZXRfcGtn
X2xpc3RfZm9yX3FlbXUobW9kX2lkKToKICAgICIiIgogICAgR2V0IHBhY2thZ2UgbGlzdCBmb3Ig
cWVtdSBhbmQgcWVtdSBkZXBlbmRlbmNpZXMuCiAgICAiIiIKICAgIHBrZ19saXN0ID0gW10KICAg
IG1vZF9pbmZvID0gX2dldF9tb2RfaW5mb19mcm9tX21icyhtb2RfaWQpCiAgICBjcG50X2xpc3Qg
PSBfZ2V0X2NwbnRfbGlzdF9mb3JfcWVtdShtb2RfaW5mbykKICAgIGZvciBjcG50IGluIGNwbnRf
bGlzdDoKICAgICAgICBwa2dfbGlzdC5hcHBlbmQobW9kX2luZm8uZ2V0KCJycG1zIikuZ2V0KGNw
bnQpLmdldCgibnZyIikpCiAgICByZXR1cm4gcGtnX2xpc3QKCmRlZiBfaW5zdGFsbF9wa2dfbGlz
dChwa2dfbGlzdCk6CiAgICAiIiIKICAgIEluc3RhbGwgcmVxdWlyZWQgcGFja2FnZXMuCiAgICAi
IiIKICAgIChyZXQsIF8sIGVycikgPSBfc3lzdGVtX3N0YXR1c19vdXRwdXQoIiVzIGluc3RhbGwg
LXkgJXMiICUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKFBLR19N
R01UX0JJTiwgcGtnX2xpc3QpKQogICAgX2V4aXRfb25fZXJyb3IocmV0LCAiSW5zdGFsbCBwYWNr
YWdlcyAnJXMnIGZhaWxlZCwgZXJyb3IgbWVzc2FnZTogJXMiICUKICAgICAgICAgICAgICAgICAg
IChwa2dfbGlzdCwgZXJyKSkKCgojIEEgY29sbGVjdGlvbiBvZiBQeXRob24gYmFzaWMgZnVuY3Rp
b25zCmRlZiBlbmFibGVfbW9kKG1vZF9zcGVjX2xpc3QpOgogICAgIiIiCiAgICBFbmFibGUgYWxs
IHRoZSBtb2R1bGUgc3RyZWFtcyBpbiB0aGUgbW9kdWxlIHNwZWMgbGlzdCBhbmQgbWFrZSB0aGUg
c3RyZWFtCiAgICBSUE1zIGF2YWlsYWJsZSBpbiB0aGUgcGFja2FnZSBzZXQuCiAgICAiIiIKICAg
IGlmIG5vdCBtb2Rfc3BlY19saXN0OgogICAgICAgIHJldHVybgogICAgZm9yIG1vZF9zcGVjIGlu
IG1vZF9zcGVjX2xpc3Quc3BsaXQoKToKICAgICAgICBfZXhpdF9vbl9lcnJvcihfaGFzX21vZF9z
cGVjKG1vZF9zcGVjKSwKICAgICAgICAgICAgICAgICAgICAgICAiTW9kdWxlICclcycgZG9lc24n
dCBleGlzdCIgJSBtb2Rfc3BlYykKICAgICAgICBpZiBfY2hrX21vZF9lbmFibGVkKG1vZF9zcGVj
KSA9PSAwOgogICAgICAgICAgICBjb250aW51ZQogICAgICAgIF9sb2dfaW5mbygiRW5hYmxlIE1v
ZHVsZSAlcyIgJSBtb2Rfc3BlYykKICAgICAgICAocmV0LCBfLCBlcnIpID0gX3N5c3RlbV9zdGF0
dXNfb3V0cHV0KCIlcyBtb2R1bGUgZW5hYmxlIC15ICVzIgogICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgJSAoUEtHX01HTVRfQklOLCBtb2Rfc3BlYykpCiAgICAg
ICAgaWYgcmV0ICE9IDA6CiAgICAgICAgICAgIF9leGl0X29uX2Vycm9yKF9jaGtfbW9kX2VuYWJs
ZWQobW9kX3NwZWMpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAiTW9kdWxlICclcycgd2Fz
bid0IGVuYWJsZWQoJXMpIiAlIChtb2Rfc3BlYywgZXJyKSkKCmRlZiBkaXNhYmxlX21vZChtb2Rf
c3BlY19saXN0KToKICAgICIiIgogICAgRGlzYWJsZSBhbGwgdGhlIG1vZHVsZSBpbiB0aGUgbW9k
dWxlIHNwZWMgbGlzdC4gQWxsIHJlbGF0ZWQgbW9kdWxlIHN0cmVhbXMKICAgIHdpbGwgYmVjb21l
IHVuYXZhaWxhYmxlLgogICAgIiIiCiAgICBpZiBub3QgbW9kX3NwZWNfbGlzdDoKICAgICAgICBy
ZXR1cm4KICAgIGZvciBtb2Rfc3BlYyBpbiBtb2Rfc3BlY19saXN0LnNwbGl0KCk6CiAgICAgICAg
X2V4aXRfb25fZXJyb3IoX2hhc19tb2Rfc3BlYyhtb2Rfc3BlYyksCiAgICAgICAgICAgICAgICAg
ICAgICAgIk1vZHVsZSAnJXMnIGRvZXNuJ3QgZXhpc3QiICUgbW9kX3NwZWMpCiAgICAgICAgbW9k
X25hbWUgPSBtb2Rfc3BlYy5zcGxpdCgiOiIpWzBdCiAgICAgICAgaWYgX2Noa19tb2RfZGlzYWJs
ZWQobW9kX25hbWUpID09IDA6CiAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgX2xvZ19pbmZv
KCJEaXNhYmxlIE1vZHVsZSAlcyIgJSBtb2RfbmFtZSkKICAgICAgICAocmV0LCBfLCBlcnIpID0g
X3N5c3RlbV9zdGF0dXNfb3V0cHV0KCIlcyBtb2R1bGUgZGlzYWJsZSAteSAlcyIKICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICUgKFBLR19NR01UX0JJTiwgbW9k
X25hbWUpKQogICAgICAgIGlmIHJldCAhPTA6CiAgICAgICAgICAgIF9leGl0X29uX2Vycm9yKF9j
aGtfbW9kX2Rpc2FibGVkKG1vZF9uYW1lKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIk1v
ZHVsZSAnJXMnIHdhc24ndCBkaXNhYmxlZCglcykiICUKICAgICAgICAgICAgICAgICAgICAgICAg
ICAgKG1vZF9uYW1lLCBlcnIpKQoKZGVmIGluc3RhbGxfbW9kKG1vZF9zcGVjX2xpc3QpOgogICAg
IiIiCiAgICBJbnN0YWxsIGFsbCB0aGUgbW9kdWxlIHByb2ZpbGVzIGluY2wuIHRoZWlyIFJQTXMg
aW4gdGhlIG1vZHVsZSBzcGVjIGxpc3QuCiAgICBJbiBjYXNlIG5vIHByb2ZpbGUgd2FzIHByb3Zp
ZGVkLCBhbGwgZGVmYXVsdCBwcm9maWxlcyBnZXQgaW5zdGFsbGVkLiBNb2R1bGUKICAgIHN0cmVh
bXMgZ2V0IGVuYWJsZWQgYWNjb3JkaW5nbHkuCiAgICAiIiIKICAgIGlmIG5vdCBtb2Rfc3BlY19s
aXN0OgogICAgICAgIHJldHVybgogICAgZm9yIG1vZF9zcGVjIGluIG1vZF9zcGVjX2xpc3Quc3Bs
aXQoKToKICAgICAgICBfZXhpdF9vbl9lcnJvcihfaGFzX21vZF9zcGVjKG1vZF9zcGVjKSwKICAg
ICAgICAgICAgICAgICAgICAgICAiTW9kdWxlICclcycgZG9lc24ndCBleGlzdCIgJSBtb2Rfc3Bl
YykKICAgICAgICBpZiBfY2hrX21vZF9pbnN0YWxsZWQobW9kX3NwZWMpID09IDA6CiAgICAgICAg
ICAgIGNvbnRpbnVlCiAgICAgICAgbW9kX25hbWUgPSBtb2Rfc3BlYy5zcGxpdCgiOiIpWzBdCiAg
ICAgICAgaWYgX2Noa19tb2RfaW5zdGFsbGVkKG1vZF9uYW1lKSA9PSAwOgogICAgICAgICAgICBf
c3lzdGVtKCIlcyBtb2R1bGUgcmVtb3ZlIC15ICVzIiAlIChQS0dfTUdNVF9CSU4sIG1vZF9uYW1l
KSkKICAgICAgICBfbG9nX2luZm8oIkluc3RhbGwgTW9kdWxlICVzIiAlIG1vZF9zcGVjKQogICAg
ICAgIG91dCA9IF9zeXN0ZW1fb3V0cHV0KCJkbmYgbW9kdWxlIGluZm8gJXMiICUgbW9kX3NwZWMp
CiAgICAgICAgc2VhcmNoX29iaiA9IHJlLnNlYXJjaChyIkRlZmF1bHQgcHJvZmlsZXNccys6XHMr
KFxTKikiLCBvdXQsIHJlLkkpCiAgICAgICAgaWYgbm90IHNlYXJjaF9vYmo6CiAgICAgICAgICAg
IHByb2ZpbGUgPSByZS5zZWFyY2gociJQcm9maWxlc1xzKzpccysoXFMqKSIsCiAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgb3V0LCByZS5JKS5ncm91cCgxKS5zcGxpdCgnLCcpWzBdCiAg
ICAgICAgICAgIG1vZF9zcGVjID0gbW9kX3NwZWMgKyAnLycgKyBwcm9maWxlCiAgICAgICAgKHJl
dCwgXywgZXJyKSA9IF9zeXN0ZW1fc3RhdHVzX291dHB1dCgiJXMgbW9kdWxlIGluc3RhbGwgLXkg
JXMiICUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChQS0df
TUdNVF9CSU4sIG1vZF9zcGVjKSkKICAgICAgICBpZiByZXQgIT0gMDoKICAgICAgICAgICAgX2V4
aXRfb25fZXJyb3IoX2Noa19tb2RfaW5zdGFsbGVkKG1vZF9zcGVjLnNwbGl0KCcvJylbMF0pLAog
ICAgICAgICAgICAgICAgICAgICAgICAgICAiTW9kdWxlICclcycgd2Fzbid0IGluc3RhbGxlZCgl
cykiICUKICAgICAgICAgICAgICAgICAgICAgICAgICAgKG1vZF9zcGVjLCBlcnIpKQoKZGVmIGlu
c3RhbGxfcGtnX2Zyb21fcmVwbyhyZXBvX3BrZ19saXN0KToKICAgICIiIgogICAgSW5zdGFsbCBh
bGwgdGhlIHBhY2thZ2VzIGFuZCB0aGVpciBkZXBlbmRlbmNpZXMgaW4gdGhlIHBhY2thZ2UgbGlz
dAogICAgZnJvbSBhbnkgZW5hYmxlZCByZXBvc2l0b3J5LgogICAgIiIiCiAgICBpZiBub3QgcmVw
b19wa2dfbGlzdDoKICAgICAgICByZXR1cm4KICAgIGZvciByZXBvX3BrZyBpbiByZXBvX3BrZ19s
aXN0LnNwbGl0KCk6CiAgICAgICAgaWYgX2hhc19ycG0ocmVwb19wa2cpID09IDA6CiAgICAgICAg
ICAgIGlmIFBLR19NR01UX0JJTiA9PSAiZG5mIjoKICAgICAgICAgICAgICAgIChyZXQsIF8sIGVy
cikgPSBfc3lzdGVtX3N0YXR1c19vdXRwdXQoIiVzIGRpc3Ryby1zeW5jIC15ICVzIiAlCiAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChQS0dfTUdN
VF9CSU4sIHJlcG9fcGtnKSkKICAgICAgICAgICAgICAgIF9leGl0X29uX2Vycm9yKHJldCwgIlBh
Y2thZ2UgJyVzJyB3YXNuJ3Qgc3luY2VkKCVzKSIgJQogICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgKHJlcG9fcGtnLCBlcnIpKQogICAgICAgICAgICBjb250aW51ZQogICAgICAgIF9sb2df
aW5mbygiSW5zdGFsbCBwYWNrYWdlICVzIiAlIHJlcG9fcGtnKQogICAgICAgIChyZXQsIF8sIGVy
cikgPSBfc3lzdGVtX3N0YXR1c19vdXRwdXQoIiVzIGluc3RhbGwgLXkgJXMiICUKICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChQS0dfTUdNVF9CSU4sIHJlcG9f
cGtnKSkKICAgICAgICBpZiByZXQgIT0gMDoKICAgICAgICAgICAgX2V4aXRfb25fZXJyb3IoX2hh
c19ycG0ocmVwb19wa2cpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAiUGFja2FnZSAnJXMn
IHdhc24ndCBpbnN0YWxsZWQoJXMpIiAlCiAgICAgICAgICAgICAgICAgICAgICAgICAgIChyZXBv
X3BrZywgZXJyKSkKCmRlZiBpbnN0YWxsX3BrZ19mcm9tX2JyZXcoYnJld19wa2dfbGlzdCk6CiAg
ICAiIiIKICAgIEluc3RhbGwgYWxsIHRoZSBwYWNrYWdlcyBhbmQgdGhlaXIgZGVwZW5kZW5jaWVz
IGluIHRoZSBwYWNrYWdlIGxpc3QKICAgIGZyb20gYnJldy4KICAgICIiIgogICAgaWYgbm90IGJy
ZXdfcGtnX2xpc3Q6CiAgICAgICAgcmV0dXJuCiAgICBmb3IgYnJld19wa2cgaW4gYnJld19wa2df
bGlzdC5zcGxpdCgpOgogICAgICAgIChidWlsZCwgcGtncywgYXJjaGVzKSA9IF9wYXJzZV9icmV3
X3BrZyhicmV3X3BrZykKICAgICAgICBycG1fbGlzdCA9IF9nZXRfcnBtX2xpc3QoYnVpbGQsIGFy
Y2hlcykKICAgICAgICBpbnN0YWxsX3JwbV9saXN0ID0gX2dldF9yZXF1aXJlZF9ycG1fbGlzdChy
cG1fbGlzdCwgcGtncykKICAgICAgICBfbG9nX2luZm8oIkluc3RhbGwgcGFja2FnZSAlcyIgJSBi
dWlsZCkKICAgICAgICAocmV0LCBfLCBlcnIpID0gX3N5c3RlbV9zdGF0dXNfb3V0cHV0KCIlcyBp
bnN0YWxsIC15ICVzIiAlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAoUEtHX01HTVRfQklOLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICcgJy5qb2luKGluc3RhbGxfcnBtX2xpc3QpKSkKICAgICAgICBpZiByZXQgIT0g
MDoKICAgICAgICAgICAgX2V4aXRfb25fZXJyb3IoX2hhc19ycG0oYnVpbGQpLAogICAgICAgICAg
ICAgICAgICAgICAgICAgICAiUGFja2FnZSAnJXMnIHdhc24ndCBpbnN0YWxsZWQoJXMpIiAlCiAg
ICAgICAgICAgICAgICAgICAgICAgICAgIChidWlsZCwgZXJyKSkKCmRlZiBpbnN0YWxsX3ZpcnRf
cWVtdV9mcm9tX2JyZXcobW9kX2lkKToKICAgICIiIgogICAgSW5zdGFsbCBxZW11IGFuZCBxZW11
IGRlcGVuZGVuY2llcyBpbmNsdWRlZCBhIHZpcnQgbW9kdWxlLiBPdGhlciBwYWNrYWdlcwogICAg
bGlrZSBsaWJ2aXJ0IHdvdWxkbid0IGJlIGluc3RhbGxlZC4gVGhlIGFyZ3VtZW50IGNvdWxkIG1v
ZHVsZSBpZCwgcWVtdQogICAgcGFja2FnZSwga29qaSB0YWcsIGFuZCBtb2R1bGUgbmFtZSB3aXRo
IHN0cmVhbS4KICAgICIiIgogICAgaWYgbm90IG1vZF9pZDoKICAgICAgICByZXR1cm4KICAgIG1v
ZF9pZCA9IF9nZXRfbW9kX2lkKG1vZF9pZCkKICAgIGlmIG5vdCBtb2RfaWQ6CiAgICAgICAgX2V4
aXRfb25fZXJyb3IoMSwgIkZhaWx0IHRvIGdldCBtb2R1bGUgaWQiKQogICAgX2xvZ19pbmZvKCJN
b2R1bGUgaWQgaXMgJXMiICUgbW9kX2lkKQogICAgcGtnX2xpc3QgPSBfZ2V0X3BrZ19saXN0X2Zv
cl9xZW11KG1vZF9pZCkKICAgIGRpc2FibGVfbW9kKCJ2aXJ0IikKICAgIGluc3RhbGxfcGtnX2Zy
b21fYnJldygnICcuam9pbihwa2dfbGlzdCkpCgpkZWYgcGFyc2Vfb3B0cygpOgogICAgIiIiCiAg
ICBQYXJzZSBhcmd1bWVudHMuCiAgICAiIiIKICAgIHBhcnNlciA9IGFyZ3BhcnNlLkFyZ3VtZW50
UGFyc2VyKGZvcm1hdHRlcl9jbGFzcz1hcmdwYXJzZS5SYXdUZXh0SGVscEZvcm1hdHRlcikKICAg
IHBhcnNlci5hZGRfYXJndW1lbnQoCiAgICAgICAgJy0tZW5hYmxlLW1vZHVsZScsCiAgICAgICAg
YWN0aW9uPSJzdG9yZSIsCiAgICAgICAgaGVscD0nJycKICAgICAgICAgICAgIEVuYWJsZSBtb2R1
bGUgc3RyZWFtcyBpbiB0aGUgbW9kdWxlIGxpc3QgYW5kIG1ha2UgdGhlIHN0cmVhbSBSUE1zIGF2
YWlsYWJsZSBpbiB0aGUgcGFja2FnZSBzZXQuCiAgICAgICAgICAgICBTdXBwb3J0IHRvIGVuYWJs
ZSBtdWx0aXBsZSBtb2R1bGVzIGF0IG9uY2UsIHdoaWNoIGFyZSBzZXBhcmF0ZWQgYnkgc3BhY2Uu
IEV4YW1wbGU6CiAgICAgICAgICAgICBFbmFibGUgc2xvdyB0cmFpbiB2aXJ0IG1vZHVsZTogLS1l
bmFibGUtbW9kdWxlICd2aXJ0OnJoZWwnCiAgICAgICAgICAgICBFbmFibGUgZmFzdCB0cmFpbiB2
aXJ0IG1vZHVsZTogLS1lbmFibGUtbW9kdWxlICd2aXJ0OjguMC4wJwogICAgICAgICAgICAgJycn
CiAgICApCiAgICBwYXJzZXIuYWRkX2FyZ3VtZW50KAogICAgICAgICctLWRpc2FibGUtbW9kdWxl
JywKICAgICAgICBhY3Rpb249InN0b3JlIiwKICAgICAgICBoZWxwPScnJwogICAgICAgICAgICAg
RGlzYWJsZSBhIG1vZHVsZS4gQWxsIHJlbGF0ZWQgbW9kdWxlIHN0cmVhbXMgd2lsbCBiZWNvbWUg
dW5hdmFpbGFibGUuIFN1cHBvcnQgdG8gZGlzYWJsZSBtdWx0aXBsZQogICAgICAgICAgICAgbW9k
dWxlcyBhdCBvbmNlLCB3aGljaCBhcmUgc2VwYXJhdGVkIGJ5IHNwYWNlLiBFeGFtcGxlOgogICAg
ICAgICAgICAgRGlzYWJsZSB2aXJ0IG1vZHVsZTogLS1kaXNhYmxlLW1vZHVsZSAndmlydCcgb3Ig
LS1kaXNhYmxlLW1vZHVsZSAndmlydDpyaGVsJwogICAgICAgICAgICAgJycnCiAgICApCiAgICBw
YXJzZXIuYWRkX2FyZ3VtZW50KAogICAgICAgICctLWluc3RhbGwtbW9kdWxlJywKICAgICAgICBh
Y3Rpb249InN0b3JlIiwKICAgICAgICBoZWxwPScnJwogICAgICAgICAgICAgSW5zdGFsbCBtb2R1
bGUgcHJvZmlsZXMgaW5jbC4gdGhlaXIgUlBNcy4gSW4gY2FzZSBubyBwcm9maWxlIHdhcyBwcm92
aWRlZCwgYWxsIGRlZmF1bHQgcHJvZmlsZXMgZ2V0CiAgICAgICAgICAgICBpbnN0YWxsZWQuIE1v
ZHVsZSBzdHJlYW1zIGdldCBlbmFibGVkIGFjY29yZGluZ2x5LiBTdXBwb3J0IHRvIGluc3RhbGwg
bXVsdGlwbGUgbW9kdWxlcyBhdCBvbmNlLCB3aGljaAogICAgICAgICAgICAgYXJlIHNlcGFyYXRl
ZCBieSBzcGFjZS4gRXhhbXBsZToKICAgICAgICAgICAgIEluc3RhbGwgc2xvdyB0cmFpbiB2aXJ0
IG1vZHVsZTogLS1pbnN0YWxsLW1vZHVsZSAndmlydDpyaGVsJwogICAgICAgICAgICAgSW5zdGFs
bCBmYXN0IHRyYWluIHZpcnQgbW9kdWxlOiAtLWluc3RhbGwtbW9kdWxlICd2aXJ0OjguMC4wJwog
ICAgICAgICAgICAgJycnCiAgICApCiAgICBwYXJzZXIuYWRkX2FyZ3VtZW50KAogICAgICAgICct
LWluc3RhbGwtcmVwb3BrZycsCiAgICAgICAgYWN0aW9uPSJzdG9yZSIsCiAgICAgICAgaGVscD0n
JycKICAgICAgICAgICAgIEluc3RhbGwgdGhlIHBhY2thZ2UgYW5kIHRoZSBkZXBlbmRlbmNpZXMg
ZnJvbSBhbnkgZW5hYmxlZCByZXBvc2l0b3J5LiBTdXBwb3J0IHRvIGluc3RhbGwgbXVsdGlwbGUK
ICAgICAgICAgICAgIHBhY2thZ2VzIGF0IG9uY2UsIHdoaWNoIGFyZSBzZXBhcmF0ZWQgYnkgc3Bh
Y2UuIEV4YW1wbGU6CiAgICAgICAgICAgICBJbnN0YWxsIHFlbXUta3ZtIGFuZCBxZW11LWt2bS1k
ZWJ1Z2luZm86IC0taW5zdGFsbC1yZXBvcGtnICdxZW11LWt2bSBxZW11LWt2bS1kZWJ1Z2luZm8n
CiAgICAgICAgICAgICAnJycKICAgICkKICAgIHBhcnNlci5hZGRfYXJndW1lbnQoCiAgICAgICAg
Jy0taW5zdGFsbC1icmV3cGtnJywKICAgICAgICBhY3Rpb249InN0b3JlIiwKICAgICAgICBoZWxw
PScnJwogICAgICAgICAgICAgSW5zdGFsbCB0aGUgcGFja2FnZSBhbmQgdGhlIGRlcGVuZGVuY2ll
cyBmcm9tIGJyZXcuIFN1cHBvcnQgdG8gaW5zdGFsbCBtdWx0aXBsZSBwYWNrYWdlcyBhdCBvbmNl
LAogICAgICAgICAgICAgd2hpY2ggYXJlIHNlcGFyYXRlZCBieSBzcGFjZS4gRXhhbXBsZToKICAg
ICAgICAgICAgIEluc3RhbGwgc3BlY2lmaWVkIHFlbXU6IC0taW5zdGFsbC1icmV3cGtnICdxZW11
LWt2bS1yaGV2LTIuMTIuMC0yMS5lbDcnCiAgICAgICAgICAgICBJbnN0YWxsIHRoZSBsYXRlc3Qg
cGFja2FnZTogLS1pbnN0YWxsLWJyZXdwa2cgJ3FlbXUta3ZtLXJoZXZAcmhldmgtcmhlbC03LjYt
Y2FuZGlkYXRlJwogICAgICAgICAgICAgSW5zdGFsbCB0aGUgc3BlY2lmaWMgUlBNczoKICAgICAg
ICAgICAgIC0taW5zdGFsbC1icmV3cGtnICdxZW11LWt2bS1yaGV2QHJoZXZoLXJoZWwtNy42LWNh
bmRpZGF0ZS9xZW11LWltZy1yaGV2LHFlbXUta3ZtLXJoZXYnCiAgICAgICAgICAgICBJbnN0YWxs
IHRoZSBzcGVjaWZpYyBSUE1zIHdpdGggc3BlY2lmaWMgYXJjaGl0ZWN0dXJlOgogICAgICAgICAg
ICAgLS1pbnN0YWxsLWJyZXdwa2cgJ3FlbXUta3ZtLXJoZXZAcmhldmgtcmhlbC03LjYtY2FuZGlk
YXRlL3FlbXUtaW1nLXJoZXYscWVtdS1rdm0tcmhldi9wcGM2NGxlLG5vYXJjaCcKICAgICAgICAg
ICAgICcnJwogICAgKQogICAgcGFyc2VyLmFkZF9hcmd1bWVudCgKICAgICAgICAnLS1pbnN0YWxs
LXZpcnRxZW11JywKICAgICAgICBhY3Rpb249InN0b3JlIiwKICAgICAgICBoZWxwPScnJwogICAg
ICAgICAgICAgSW5zdGFsbCBxZW11IGFuZCBxZW11IGRlcGVuZGVuY2llcyBpbmNsdWRlZCBhIHZp
cnQgbW9kdWxlLiBPdGhlciBwYWNrYWdlcyBsaWtlIGxpYnZpcnQgd291bGRuJ3QgYmUKICAgICAg
ICAgICAgIGluc3RhbGxlZC4gVGhlIGFyZ3VtZW50IGNvdWxkIG1vZHVsZSBpZCwgcWVtdSBwYWNr
YWdlLCBrb2ppIHRhZywgYW5kIG1vZHVsZSBuYW1lIHdpdGggc3RyZWFtLiBFeGFtcGxlOgogICAg
ICAgICAgICAgTW9kdWxlIGlkOiAtLWluc3RhbGwtdmlydHFlbXUgJzI3MDQnCiAgICAgICAgICAg
ICBRRU1VIHBhY2thZ2U6IC0taW5zdGFsbC12aXJ0cWVtdSAncWVtdS1rdm0tMy4xLjAtNC5tb2R1
bGUrZWw4KzI2NzYrMzNiZDZlMmInCiAgICAgICAgICAgICBLb2ppIHRhZzogLS1pbnN0YWxsLXZp
cnRxZW11ICdtb2R1bGUtdmlydC04LjAuMC04MjAxOTAxMTExNjE2MzYtOWVkYmExNTInCiAgICAg
ICAgICAgICBNb2R1bGUgbmFtZTogLS1pbnN0YWxsLXZpcnRxZW11ICd2aXJ0OnJoZWwnIG9yIC0t
aW5zdGFsbC12aXJ0cWVtdSAndmlydDo4LjAuMCcKICAgICAgICAgICAgICcnJwogICAgKQogICAg
cGFyc2VyLmFkZF9hcmd1bWVudCgKICAgICAgICAnLXYnLCAnLS12ZXJib3NlJywKICAgICAgICBh
Y3Rpb249InN0b3JlX3RydWUiLAogICAgICAgIGRlZmF1bHQ9RmFsc2UsCiAgICAgICAgaGVscD0n
JycKICAgICAgICAgICAgIGdpdmUgZGV0YWlsZWQgb3V0cHV0CiAgICAgICAgICAgICAnJycKICAg
ICkKICAgIHBhcnNlci5hZGRfYXJndW1lbnQoCiAgICAgICAgJy1xJywgJy0tcXVpZXQnLAogICAg
ICAgIGFjdGlvbj0ic3RvcmVfdHJ1ZSIsCiAgICAgICAgZGVmYXVsdD1GYWxzZSwKICAgICAgICBo
ZWxwPScnJwogICAgICAgICAgICAgZ2l2ZSBsZXNzIG91dHB1dAogICAgICAgICAgICAgJycnCiAg
ICApCiAgICByZXR1cm4gdmFycyhwYXJzZXIucGFyc2VfYXJncygpKQoKaWYgX19uYW1lX18gPT0g
Il9fbWFpbl9fIjoKICAgIG9wdHMgPSBwYXJzZV9vcHRzKCkKICAgIGlmIG9wdHMuZ2V0KCJ2ZXJi
b3NlIik6CiAgICAgICAgTE9HX0xWTCA9IDQKICAgIGlmIG9wdHMuZ2V0KCJxdWlldCIpOgogICAg
ICAgIFFVSUVUID0gVHJ1ZQogICAgaWYgX2hhc19jbWQoJ3B5dGhvbjMnKToKICAgICAgICBQWVRI
T05fTU9EVUxFX0xJU1QgPSAicHl0aG9uMy1weXlhbWwiCiAgICBpZiBfaGFzX2NtZCgnZG5mJyk6
CiAgICAgICAgUEtHX01HTVRfQklOPSJkbmYiCiAgICAgICAgX2luc3RhbGxfcGtnX2xpc3QoUFlU
SE9OX01PRFVMRV9MSVNUKQogICAgICAgIGVuYWJsZV9tb2Qob3B0cy5nZXQoImVuYWJsZV9tb2R1
bGUiKSkKICAgICAgICBkaXNhYmxlX21vZChvcHRzLmdldCgiZGlzYWJsZV9tb2R1bGUiKSkKICAg
ICAgICBpbnN0YWxsX21vZChvcHRzLmdldCgiaW5zdGFsbF9tb2R1bGUiKSkKICAgICAgICBpbnN0
YWxsX3ZpcnRfcWVtdV9mcm9tX2JyZXcob3B0cy5nZXQoImluc3RhbGxfdmlydHFlbXUiKSkKICAg
IGluc3RhbGxfcGtnX2Zyb21fcmVwbyhvcHRzLmdldCgiaW5zdGFsbF9yZXBvcGtnIikpCiAgICBp
bnN0YWxsX3BrZ19mcm9tX2JyZXcob3B0cy5nZXQoImluc3RhbGxfYnJld3BrZyIpKQo=
EOF
chmod a+rx /root/component_management.py
## End 'component_management.py'

# Remove the kernel args we dont like
grubby --remove-args="rhgb quiet" --update-kernel=$(grubby --default-kernel)

sed -i 's/^SELINUX=.*/SELINUX=disabled/g' /etc/selinux/config
systemctl enable kdump.service
systemctl enable rpcbind.service
systemctl enable NetworkManager.service
systemctl enable sshd.service
systemctl enable nfs-server.service
systemctl disable firewalld.service
systemctl disable user.slice

# change the open files and the core size
host_memory_amount=$(awk '( $1 == "MemTotal:" ) { printf "%d", $2/1024/1024 }' /proc/meminfo)
echo "ProcessSizeMax=${host_memory_amount}G" >> /etc/systemd/coredump.conf
echo "ExternalSizeMax=${host_memory_amount}G" >> /etc/systemd/coredump.conf
echo "*               hard    nofile            8192" >> /etc/security/limits.conf

if ! ping "github.com" -c 5; then
    echo "export https_proxy=http://squid.corp.redhat.com:3128" >> /etc/profile
fi
dnf install -y 'https://dl.fedoraproject.org/pub/epel/epel-release-latest-8.noarch.rpm'
%end

%packages --ignoremissing
dosfstools
edk2-ovmf
gcc
gcc-c++
glibc-headers
git
gstreamer1-plugins-good
httpd
iproute
iputils
iscsi-initiator-utils
lftp
mkisofs
nfs-utils
nmap-ncat
numactl
patch
python3-devel
python3-gobject
python3-pillow
rpcbind
screen
sg3_utils
sysstat
targetcli
tcpdump
telnet
telnet-server
vsftpd
xinetd
%end
]]></ks>
